class Vec{x;y;constructor(x=0,y=x){this.x=x,this.y=y,Object.freeze(this)}clone(){return new Vec(this.x,this.y)}add(other){return new Vec(this.x+other.x,this.y+other.y)}sub(other){return new Vec(this.x-other.x,this.y-other.y)}mult(other){return"number"==typeof other?new Vec(this.x*other,this.y*other):new Vec(this.x*other.x,this.y*other.y)}div(other){return"number"==typeof other?new Vec(this.x/other,this.y/other):new Vec(this.x/other.x,this.y/other.y)}norm(){return this.div(this.length())}length(){return Math.sqrt(this.x**2+this.y**2)}distanceTo(other){return this.sub(other).length()}vectorTo(other){return other.sub(this)}directionTo(other){return this.vectorTo(other).norm()}rotate(rad){return new Vec(this.x*Math.cos(rad)-this.y*Math.sin(rad),this.x*Math.sin(rad)+this.y*Math.cos(rad))}interpolateTo(other){const t=d3.interpolateObject(this,other);return i=>Vec.from(t(i))}static interpolateVecArray(from,to){const t=d3.interpolate(from,to),s=x=>Array.isArray(x)?x.map(e=>s(e)):Vec.from(x);return i=>s(t(i))}static from(object){return"number"==typeof object.x&&"number"==typeof object.y?new Vec(object.x,object.y):new Vec(parseFloat(object.x),parseFloat(object.y))}static rad(deg){return deg/(180*Math.PI)}static deg(rad){return 180*Math.PI/rad}}class Styles{liveColor;deadColor;liveWidth;deadWidth;liveOpacity;deadOpacity;constructor(liveColor,deadColor,liveWidth,deadWidth,liveOpacity=1,deadOpacity=1){this.liveColor=liveColor,this.deadColor=deadColor,this.liveWidth=liveWidth,this.deadWidth=deadWidth,this.liveOpacity=liveOpacity,this.deadOpacity=deadOpacity,Object.freeze(this)}clone(){return new Styles(this.liveColor,this.deadColor,this.liveWidth,this.deadWidth,this.liveOpacity,this.deadOpacity)}}const HIDDEN_STYLES=new Styles("none","none",0,0,0,0);class Junction{_anchor;_svgCircle;_powered;_pos;_styles;_incoming=new Set;_outgoing=new Set;constructor(anchor,pos,styles){this._anchor=anchor,this._svgCircle=this._anchor.append("circle"),this._powered=!1,this.pos=pos,this.styles=styles,this._svgCircle.attr("stroke-width","0")}get styles(){return this._styles}set styles(styles){this._styles=styles,this._powered?this._svgCircle.attr("r",this._styles.liveWidth).attr("fill",this._styles.liveColor).attr("fill-opacity",this._styles.liveOpacity):this._svgCircle.attr("r",this._styles.deadWidth).attr("fill",this._styles.deadColor).attr("fill-opacity",this._styles.deadOpacity)}get pos(){return this._pos}set pos(pos){this._pos=pos,this._svgCircle.attr("cx",this._pos.x).attr("cy",this._pos.y);for(const t of this._outgoing)t._updateOutofPosition();for(const e of this._incoming)e._updateIntoPosition()}get incoming(){return Object.freeze(new Set(this._incoming))}get outgoing(){return Object.freeze(new Set(this._outgoing))}powerOn(){if(this._powered)return Promise.resolve();this._powered=!0;var t=[];t.push(this._svgCircle.transition().duration(50).attr("r",this._styles.liveWidth).attr("fill",this._styles.liveColor).attr("fill-opacity",this._styles.liveOpacity).end());for(const e of this._outgoing)t.push(e.animateOnForward());for(const s of this._incoming)t.push(s.animateOnReverse());return Promise.all(t)}isPoweredOn(){return this._powered}powerOff(){if(!this._powered)return Promise.resolve();this._powered=!1;var t=[];t.push(this._svgCircle.transition().duration(50).attr("r",this._styles.deadWidth).attr("fill",this._styles.deadColor).attr("fill-opacity",this._styles.deadOpacity).end());for(const e of this._outgoing)t.push(e.animateOffForward());for(const s of this._incoming)t.push(s.animateOffReverse());return Promise.all(t)}forceOff(){this._powered=!1,this._svgCircle.attr("r",this._styles.deadWidth).attr("fill",this._styles.deadColor).attr("fill-opacity",this._styles.deadOpacity)}connectedSet(){for(var t=new Set([this]),e=[this];0!==e.length;){var s=e.pop();for(const i of s._outgoing)t.has(i._into)||(t.add(i._into),e.push(i._into));for(const o of s._incoming)t.has(o._outof)||(t.add(o._outof),e.push(o._outof))}return t}cloneWithoutConnections(){return new Junction(this._anchor,this._pos,this._styles)}absorb(junction){if(this!==junction){for(const t of junction._incoming)t.into=this;for(const e of junction._outgoing)e.outof=this;junction.destroy()}return this}destroy(){this._svgCircle.remove()}}class Wire{_liveAnchor;_deadAnchor;_svgForwardLive;_svgReverseLive;_svgDead;_animationSpeed;_styles;_outof=null;_into=null;static POWER_OFF_ANIMATION_SPEED=5e3;constructor(liveAnchor,deadAnchor,outof,into,animationSpeed,styles){this._liveAnchor=liveAnchor,this._deadAnchor=deadAnchor,this._svgDead=this._deadAnchor.append("line"),this._svgForwardLive=this._liveAnchor.append("line"),this._svgReverseLive=this._liveAnchor.append("line"),this.outof=outof,this.into=into,this.styles=styles,this.animationSpeed=animationSpeed,this._svgForwardLive.attr("stroke-linecap","round"),this._svgReverseLive.attr("stroke-linecap","round"),this._svgDead.attr("stroke-linecap","round"),this._svgForwardLive.attr("visibility","hidden"),this._svgReverseLive.attr("visibility","hidden")}get outof(){return this._outof}set outof(outof){this._outof!==outof&&(this._outof&&this._outof._outgoing.delete(this),this._outof=outof,this._outof)&&this._outof._outgoing.add(this),this._outof&&this._updateOutofPosition()}get into(){return this._into}set into(into){this._into!==into&&(this._into&&this._into._incoming.delete(this),this._into=into,this._into)&&this._into._incoming.add(this),this._into&&this._updateIntoPosition()}get animationSpeed(){return this._animationSpeed}set animationSpeed(animationSpeed){this._animationSpeed=animationSpeed,this._svgForwardLive.interrupt(),this._svgReverseLive.interrupt()}get styles(){return this._styles}set styles(styles){this._styles=styles,this._svgForwardLive.attr("stroke-width",this._styles.liveWidth).attr("stroke",this._styles.liveColor).attr("stroke-opacity",this._styles.liveOpacity),this._svgReverseLive.attr("stroke-width",this._styles.liveWidth).attr("stroke",this._styles.liveColor).attr("stroke-opacity",this._styles.liveOpacity),this._svgDead.attr("stroke-width",this._styles.deadWidth).attr("stroke",this._styles.deadColor).attr("stroke-opacity",this._styles.deadOpacity)}disconnectOutof(){return this.outof=this._outof.cloneWithoutConnections(),this._outof}disconnectInto(){return this.into=this._into.cloneWithoutConnections(),this._into}animateOnForward(){var t;return null===this._animationSpeed?Promise.reject():this._fullyLive?this._into.powerOn():this._animationSpeed===1/0?(this._svgForwardLive.attr("x2",this._into._pos.x).attr("y2",this._into._pos.y).attr("visibility","visible"),this._into.powerOn()):(t=(1-this._forwardAnimationFrac)*this._wireLength/this._animationSpeed,this._svgForwardLive.attr("visibility","visible").transition().ease(d3.easeLinear).duration(1e3*t).attr("x2",this._into._pos.x).attr("y2",this._into._pos.y).end().catch(()=>this.animateOnForward()).then(()=>this._into.powerOn()))}animateOnReverse(){var t;return null===this._animationSpeed?Promise.reject():this._fullyLive?this._outof.powerOn():this._animationSpeed===1/0?(this._svgReverseLive.attr("x1",this._outof._pos.x).attr("y1",this._outof._pos.y).attr("visibility","visible"),this._outof.powerOn()):(t=(1-this._reverseAnimationFrac)*this._wireLength/this._animationSpeed,this._svgReverseLive.attr("visibility","visible").transition().ease(d3.easeLinear).duration(1e3*t).attr("x1",this._outof._pos.x).attr("y1",this._outof._pos.y).end().catch(()=>this.animateOnReverse()).then(()=>this._outof.powerOn()))}animateOffForward(){this._fullyLive&&this._svgForwardLive.attr("x2",this._svgReverseLive.attr("x1")).attr("y2",this._svgReverseLive.attr("y1"));const t=this._forwardAnimationFrac;var e=t*this._wireLength/Wire.POWER_OFF_ANIMATION_SPEED;return this._svgForwardLive.transition().ease(d3.easeLinear).duration(1e3*e).attr("x1",this._svgForwardLive.attr("x2")).attr("y1",this._svgForwardLive.attr("y2")).end().catch(()=>this.animateOffForward()).finally(()=>this._svgForwardLive.attr("x1",this._outof.pos.x).attr("y1",this._outof.pos.y).attr("x2",this._outof.pos.x).attr("y2",this._outof.pos.y).attr("visibility","hidden")).then(()=>{if(1===t)return this._into.powerOff()})}animateOffReverse(){this._fullyLive&&this._svgReverseLive.attr("x1",this._svgForwardLive.attr("x2")).attr("y1",this._svgForwardLive.attr("y2"));const t=this._reverseAnimationFrac;var e=t*this._wireLength/Wire.POWER_OFF_ANIMATION_SPEED;return this._svgReverseLive.transition().ease(d3.easeLinear).duration(1e3*e).attr("x2",this._svgReverseLive.attr("x1")).attr("y2",this._svgReverseLive.attr("y1")).end().catch(()=>this.animateOffReverse()).finally(()=>this._svgReverseLive.attr("x1",this._into.pos.x).attr("y1",this._into.pos.y).attr("x2",this._into.pos.x).attr("y2",this._into.pos.y).attr("visibility","hidden")).then(()=>{if(1===t)return this._outof.powerOff()})}resetAnimation(){this._svgForwardLive.attr("x1",this._outof._pos.x).attr("y1",this._outof._pos.y).attr("x2",this._outof._pos.x).attr("y2",this._outof._pos.y).attr("visibility","hidden"),this._svgReverseLive.attr("x1",this._into._pos.x).attr("y1",this._into._pos.y).attr("x2",this._into._pos.x).attr("y2",this._into._pos.y).attr("visibility","hidden")}get _wireLength(){return Math.sqrt((this._outof._pos.x-this._into._pos.x)**2+(this._outof._pos.y-this._into._pos.y)**2)}get _forwardAnimationFrac(){var t=parseFloat(this._svgForwardLive.attr("x2")),e=parseFloat(this._svgForwardLive.attr("y2"));return Math.sqrt((this._outof._pos.x-t)**2+(this._outof._pos.y-e)**2)/this._wireLength}get _reverseAnimationFrac(){var t=parseFloat(this._svgReverseLive.attr("x1")),e=parseFloat(this._svgReverseLive.attr("y1"));return Math.sqrt((this._into._pos.x-t)**2+(this._into._pos.y-e)**2)/this._wireLength}get _fullyLive(){return 1<=this._forwardAnimationFrac+this._reverseAnimationFrac}_updateOutofPosition(){this._svgDead.attr("x1",this._outof.pos.x).attr("y1",this._outof.pos.y),this._svgForwardLive.attr("x1",this._outof.pos.x).attr("y1",this._outof.pos.y),this._svgForwardLive.attr("x2",this._outof.pos.x).attr("y2",this._outof.pos.y)}_updateIntoPosition(){this._svgDead.attr("x2",this._into.pos.x).attr("y2",this._into.pos.y),this._svgReverseLive.attr("x2",this._into.pos.x).attr("y2",this._into.pos.y),this._svgReverseLive.attr("x1",this._into.pos.x).attr("y1",this._into.pos.y)}destroy(){this._svgForwardLive.remove(),this._svgReverseLive.remove(),this._svgDead.remove(),this.outof=null,this.into=null}}class Plug{alphabet;_junctions=[];_incoming=new Set;_outgoing=new Set;_anchor;_pos;_offsets=[];_styles;constructor(anchor,alphabet,pos,offsets,styles){this.alphabet=alphabet,this._anchor=anchor,this._pos=pos,this._offsets=Object.freeze(offsets.slice()),this._styles=styles;for(let t=0;t<this.alphabet.length;++t)this._junctions.push(new Junction(anchor,this._pos.add(this._offsets[t]),styles))}get pos(){return this._pos}set pos(pos){this._pos=pos;for(let t=0;t<this.alphabet.length;t++)this._junctions[t].pos=this._pos.add(this._offsets[t])}get offsets(){return this._offsets}set offsets(offsets){this._offsets=Object.freeze(offsets.slice());for(let t=0;t<this.alphabet.length;t++)this._junctions[t].pos=this._pos.add(this._offsets[t])}get junctions(){return Object.freeze(this._junctions.slice())}get styles(){return this._styles}set styles(styles){this._styles=styles;for(const t of this._junctions)t.styles=this._styles}powerOn(junction){if(junction<0||junction>=this.alphabet.length)throw new Error("Plug.powerOn: Junction index out of bounds");return this._junctions[junction].powerOn()}powerOff(junction){if(junction<0||junction>=this.alphabet.length)throw new Error("Plug.powerOff: Junction index out of bounds");return this._junctions[junction].powerOff()}isPoweredOn(junction){return this._junctions[junction].isPoweredOn()}forceOffAll(){for(const t of this._junctions)t.forceOff()}connectedSet(i){if(i<0||i>=this.alphabet.length)throw new Error("Plug.connectedSet: Junction index out of bounds");var e=this._junctions[i].connectedSet(),s=new Set;for(let t=0;t<this.alphabet.length;++t)e.has(this._junctions[t])&&s.add(t);return s}partitionConnectivity(){let e=[];for(let t=0;t<this.alphabet.length;++t)e.push(t);for(var s=[];0!==e.length;){let t=this.connectedSet(e.pop());e=e.filter(i=>!t.has(i)),s.push(t)}return s}fullyConnected(){return this.connectedSet(0).size===this.alphabet.length}cloneWithoutConnections(){return new Plug(this._anchor,this.alphabet,this._pos,this._offsets,this._styles)}absorb(plug){if(this!==plug){for(const t of plug._incoming)t.into=this;for(const e of plug._outgoing)e.outof=this;plug.destroy()}return this}get numLive(){let t=0;for(const e of this._junctions)e.isPoweredOn()&&++t;return t}destroy(){for(const t of this._junctions)t.destroy()}}class Cable{alphabet;_wires=[];_outof=null;_into=null;_animationSpeed;_styles;constructor(liveAnchor,deadAnchor,alphabet,outof,into,animationSpeed,styles){this.alphabet=alphabet,this._animationSpeed=animationSpeed,this._styles=styles;for(let t=0;t<this.alphabet.length;t++)this._wires.push(new Wire(liveAnchor,deadAnchor,null,null,this._animationSpeed,this._styles));this.into=into,this.outof=outof}get into(){return this._into}set into(into){if(this.into&&this._into!==into&&this._into._incoming.delete(this),this._into=into,this._into){this._into._incoming.add(this);for(let t=0;t<this.alphabet.length;++t)this._wires[t].into=this._into.junctions[t]}}get outof(){return this._outof}set outof(outof){if(this.outof&&this._outof!==outof&&this._outof._outgoing.delete(this),this._outof=outof,this._outof){this._outof._outgoing.add(this);for(let t=0;t<this.alphabet.length;++t)this._wires[t].outof=this._outof.junctions[t]}}get wires(){return Object.freeze(this._wires.slice())}get styles(){return this._styles}set styles(styles){this._styles=styles;for(const t of this._wires)t.styles=this._styles}get animationSpeed(){return this._animationSpeed}set animationSpeed(animationSpeed){this._animationSpeed=animationSpeed;for(const t of this._wires)t.animationSpeed=animationSpeed}resetAnimations(){for(const t of this._wires)t.resetAnimation()}disconnectOutof(){return this.outof=this._outof.cloneWithoutConnections(),this._outof}disconnectInto(){return this.into=this._into.cloneWithoutConnections(),this._into}destroy(){for(const t of this._wires)t.destroy()}}class Scrambler{_wiring=[];_inverse=[];_rotation=0;constructor(wiring,rotation=0){if(!Scrambler._checkWiring(wiring))throw new Error("Scrambler.constructor: wiring is not valid");this._wiring=Object.freeze(wiring.slice()),this._inverse=new Array(this._wiring.length);for(let t=0;t<this._wiring.length;++t)this._inverse[this._wiring[t]]=t;this._rotation=rotation}get domain(){return this._wiring.length}get rotation(){return this._rotation}set rotation(offset){this._rotation=Scrambler.nonNegativeMod(offset,this._wiring.length)}encode(i){return Scrambler.nonNegativeMod(this._wiring[Scrambler.nonNegativeMod(i+this._rotation,this._wiring.length)]-this.rotation,this._wiring.length)}decode(i){return Scrambler.nonNegativeMod(this._inverse[Scrambler.nonNegativeMod(i+this._rotation,this._wiring.length)]-this.rotation,this._wiring.length)}isReflector(){return Scrambler._checkReflectorWiring(this._wiring)}static _checkWiring(wiring){var t=new Set;for(const e of wiring){if(e<0||e>=wiring.length||t.has(e))return!1;t.add(e)}return!0}static _checkReflectorWiring(wiring){if(!this._checkWiring(wiring))return!1;if(wiring.length%2!=0)return!1;for(let t=0;t<wiring.length;++t)if(wiring[wiring[t]]!==t)return!1;return!0}static identityScrambler(size){var e=new Array(size);for(let t=0;t<size;++t)e[t]=t;return new Scrambler(e)}static randomScrambler(size){var e=new Array(size);for(let t=0;t<size;++t)e[t]=t;for(let t=e.length-1;0<t;--t){var s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return new Scrambler(e)}static randomReflector(size){if(size%2!=0)throw new Error("Scrambler.randomReflector: a reflector must have a size divisible by 2");var e=new Array(size);for(let t=0;t<size;++t)e[t]=t;for(var t=new Array(size);0!==e.length;){var s=e.splice(Math.floor(Math.random()*e.length),1)[0],i=e.splice(Math.floor(Math.random()*e.length),1)[0];t[s]=i,t[i]=s}return new Scrambler(t)}clone(){var t=new Scrambler(this._wiring);return t.rotation=this._rotation,t}sameMapping(other){for(let t=0;t<this._wiring.length;++t)if(this._wiring[t]!==other._wiring[t])return!1;return!0}toString(alphabet){let e="";for(let t=0;t<this._wiring.length;++t)e+=alphabet.charAt(this._wiring[t]);return e}static fromString(stringWiring,alphabet){var e=new Array(stringWiring.length);for(let t=0;t<stringWiring.length;++t)e[t]=alphabet.indexOf(stringWiring.charAt(t));return new Scrambler(e)}static nonNegativeMod(n,m){return(~~n%m+m)%m}}const ENIGMA_I=Scrambler.fromString("EKMFLGDQVZNTOWYHXUSPAIBRCJ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_II=Scrambler.fromString("AJDKSIRUXBLHWTMCQGZNPYFVOE","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_III=Scrambler.fromString("BDFHJLCPRTXVZNYEIWGAKMUSQO","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_IV=Scrambler.fromString("ESOVPZJAYQUIRHXLNFTGKDCMWB","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_V=Scrambler.fromString("VZBRGITYUPSDNHLXAWMJQOFECK","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_VI=Scrambler.fromString("JPGVOUMFYQBENHZRDKASXLICTW","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_VII=Scrambler.fromString("FKQHTLXOCBJSPDZRAMEWNIUYGV","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_VIII=Scrambler.fromString("FKQHTLXOCBJSPDZRAMEWNIUYGV","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_A=Scrambler.fromString("EJMZALYXVBWFCRQUONTSPIKHGD","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_B=Scrambler.fromString("YRUHQSLDPXNGOKMIEBFZCWVJAT","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_C=Scrambler.fromString("FVPJIAOYEDRZXWGCTKUQSBNMHL","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_B_THIN=Scrambler.fromString("ENKQAUYWJICOPBLMDXZVFTHRGS","ABCDEFGHIJKLMNOPQRSTUVWXYZ"),ENIGMA_C_THIN=Scrambler.fromString("RDOBJNTKVEHMLFCWZAXGYIPSUQ","ABCDEFGHIJKLMNOPQRSTUVWXYZ");class ScramblerCasing{_scramblers;constructor(scramblers){this.scramblers=scramblers}get domain(){return this._scramblers[0].domain}get scramblers(){return Object.freeze(this._scramblers.slice())}set scramblers(scramblers){if(!Array.isArray(scramblers)||4!==scramblers.length)throw new Error("ScramblerCasing.scramblers: Expected an array of four scramblers");for(let t=1;t<scramblers.length;++t)if(scramblers[t].size!==scramblers[t-1].size)throw new Error("ScramblerCasing.scramblers: Scrambler sizes are not all equal");if(!scramblers[3].isReflector())throw new Error("ScramblerCasing.scramblers: Fourth scrambler is not a reflector (it should be a symmetric bijection)");this._scramblers=[];for(const t of scramblers)this._scramblers.push(t.clone())}get rotation(){return this._scramblers[2].rotation+this._scramblers[1].rotation*this.domain+this._scramblers[0].rotation*this.domain*this.domain}set rotation(rotation){this._scramblers[2].rotation=Scrambler.nonNegativeMod(rotation,this.domain),this._scramblers[1].rotation=Scrambler.nonNegativeMod(Math.floor(rotation/=this.domain),this.domain),this._scramblers[0].rotation=Scrambler.nonNegativeMod(Math.floor(rotation/this.domain),this.domain)}get inverseRotation(){return this._scramblers[0].rotation+this._scramblers[1].rotation*this.domain+this._scramblers[2].rotation*this.domain*this.domain}set inverseRotation(rotation){this._scramblers[0].rotation=Scrambler.nonNegativeMod(rotation,this.domain),this._scramblers[1].rotation=Scrambler.nonNegativeMod(Math.floor(rotation/=this.domain),this.domain),this._scramblers[2].rotation=Scrambler.nonNegativeMod(Math.floor(rotation/this.domain),this.domain)}get rotations(){return Object.freeze([this._scramblers[0].rotation,this._scramblers[1].rotation,this._scramblers[2].rotation])}set rotations(rotations){for(let t=0;t<3;++t)this._scramblers[t].rotation=rotations[t]}encode(e){return e=this._scramblers[2].encode(e),e=this._scramblers[1].encode(e),e=this._scramblers[0].encode(e),e=this._scramblers[3].encode(e),e=this._scramblers[0].decode(e),e=this._scramblers[1].decode(e),e=this._scramblers[2].decode(e)}encodeCrib(alphabet,plainText,steckerings){let e="";for(let t=0;t<plainText.length;++t)++this._scramblers[2].rotation,e+=alphabet.charAt(steckerings[this.encode(steckerings[alphabet.indexOf(plainText.charAt(t))])]);return this._scramblers[2].rotation-=plainText.length,e}clone(){return new ScramblerCasing(this._scramblers)}}class Drum extends Cable{_scramblers;constructor(liveAnchor,deadAnchor,alphabet,outof,into,animationSpeed,styles,scramblers){if(super(liveAnchor,deadAnchor,alphabet,outof,into,animationSpeed,styles),this._scramblers=scramblers.clone(),this._scramblers.scramblers[0].domain!==this.alphabet.length)throw new Error("Drum.constructor: Scrambler sizes are not equal to the alphabet size");this._configureWiring()}get into(){return super.into}set into(into){super.into=into,this._configureWiring()}get scramblers(){return this._scramblers}set scramblers(scramblers){this._scramblers=scramblers,this._configureWiring()}get rotation(){return this._scramblers.rotation}set rotation(rotation){this._scramblers.rotation=rotation,this._configureWiring()}get inverseRotation(){return this._scramblers.inverseRotation}set inverseRotation(rotation){this._scramblers.inverseRotation=rotation,this._configureWiring()}get rotations(){return this._scramblers.rotations}set rotations(rotations){this._scramblers.rotations=rotations,this._configureWiring()}_configureWiring(){if(this._scramblers&&this._into)for(let t=0;t<this.alphabet.length;++t)this._wires[t].into=this._into.junctions[this._scramblers.encode(t)]}}class BombeMenu{alphabet;steckerAlphabet;plainText;cipherText;_usedChars;_svgRoot;_nodeAnchor;_steckerAnchor;_edgeAnchor;_simulation;_simulationLetterNodes;_simulationLabelNodes;_simulationLinks;static LINK_STROKE_WIDTH=1;static NODE_FONT_SIZE=12;static LABEL_FONT_SIZE=10;static NODE_RADIUS=10;static LINK_DISTANCE=90;static STECKER_RADIUS=7;static STECKER_FONT_SIZE=11;static STECKER_POSITION_FACTOR=3.7;static STECKER_LINK_WAVELENGTH=7;static STECKER_LINK_AMPLITUDE=2;static ALPHA=2;static ALPHA_DECAY=.001;static ALPHA_MIN=.001;static NODE_REPULSION=-60;static CENTRE_ATTRACTION=.02;static NODE_REPULSION_MIN=.01;static NODE_REPULSION_MAX=7*BombeMenu.LINK_DISTANCE;static LINK_ATTRACTION=.2;constructor(svgRoot,alphabet,steckerAlphabet,plainText,cipherText,complexRender=!1){if(this.alphabet=alphabet,this.steckerAlphabet=steckerAlphabet,this.plainText=plainText,this.cipherText=cipherText,this._svgRoot=svgRoot,this._edgeAnchor=this._svgRoot.append("g"),this._steckerAnchor=this._svgRoot.append("g"),this._nodeAnchor=this._svgRoot.append("g"),this.alphabet.length!==this.steckerAlphabet.length)throw new Error("BombeMenu.constructor: alphabet and stecker alphabet differ in length");if(this.plainText.length!==this.cipherText.length)throw new Error("BombeMenu.constructor: plaintext differs in length from ciphertext");for(let t=0;t<this.plainText.length;++t)if(this.plainText.charAt(t)===this.cipherText.charAt(t))throw new Error("BombeMenu.constructor: a character cannot be encoded to itself");var s,t=new Set;for(const c of this.plainText)t.add(c);for(const c of this.cipherText)t.add(c);this._usedChars=Array.from(t).join("");for(const c of this._usedChars)if(this.alphabet.indexOf(c)<0)throw new Error("BombeMenu.constructor: plaintext and ciphertext are not subsets of the alphabet");this._simulationLetterNodes=this._usedChars.split("").map(c=>({name:c,steckerName:steckerAlphabet.charAt(this.alphabet.indexOf(c)),outgoing:[],incoming:[],marked:!1,edgeCount:0})),this._simulationLabelNodes=[],this._simulationLinks=[];for(let e=0;e<plainText.length;++e){const i=this._simulationLetterNodes[this._usedChars.indexOf(this.plainText.charAt(e))],o=this._simulationLetterNodes[this._usedChars.indexOf(this.cipherText.charAt(e))];let t=this._simulationLinks.find(link=>link.source===i&&link.target===o||link.target===i&&link.source===o);void 0!==t?(t.label.name+=","+(e+1),t.compound++):(s={name:""+(e+1)},t={label:s,source:i,target:o,compound:1},this._simulationLabelNodes.push(s),this._simulationLinks.push(t),t.source.outgoing.push(t),t.target.incoming.push(t)),t.source.edgeCount++,t.target.edgeCount++}this._simulation=d3.forceSimulation([...this._simulationLetterNodes,...this._simulationLabelNodes]).alpha(BombeMenu.ALPHA).alphaMin(BombeMenu.ALPHA_MIN).alphaDecay(BombeMenu.ALPHA_DECAY).force("x",d3.forceX(0).strength(BombeMenu.CENTRE_ATTRACTION)).force("y",d3.forceY(0).strength(BombeMenu.CENTRE_ATTRACTION)).force("manyBody",d3.forceManyBody().strength(BombeMenu.NODE_REPULSION).distanceMin(BombeMenu.NODE_REPULSION_MIN).distanceMax(BombeMenu.NODE_REPULSION_MAX)).force("link",d3.forceLink().links(this._simulationLinks).distance(()=>BombeMenu.LINK_DISTANCE).strength(()=>BombeMenu.LINK_ATTRACTION));for(let t=0;t<Math.ceil(Math.log(BombeMenu.ALPHA_MIN)/Math.log(1-BombeMenu.ALPHA_DECAY));++t){this._simulation.tick();for(let t=0;t<this._simulationLabelNodes.length;++t)this._simulationLabelNodes[t].x=(this._simulationLinks[t].source.x+this._simulationLinks[t].target.x)/2,this._simulationLabelNodes[t].vx=(this._simulationLinks[t].source.vx+this._simulationLinks[t].target.vx)/2,this._simulationLabelNodes[t].y=(this._simulationLinks[t].source.y+this._simulationLinks[t].target.y)/2,this._simulationLabelNodes[t].vy=(this._simulationLinks[t].source.vy+this._simulationLinks[t].target.vy)/2}this._simulation.stop(),complexRender?this.complexRender():this.simpleRender()}simpleRender(){this._clearRender(),this._nodeAnchor.selectAll("circle").data(this._simulationLetterNodes).join("circle").attr("class",d=>d.name).attr("r",BombeMenu.NODE_RADIUS).attr("fill","lightgrey").attr("stroke-width",BombeMenu.LINK_STROKE_WIDTH).attr("stroke","grey").attr("cx",d=>d.x).attr("cy",d=>d.y),this._nodeAnchor.selectAll("text").data(this._simulationLetterNodes).join("text").text(d=>d.name).attr("class",d=>d.name).attr("font-family","Courier New").attr("font-size",BombeMenu.NODE_FONT_SIZE).attr("font-weight","bold").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("x",d=>d.x).attr("y",d=>d.y),this._edgeAnchor.selectAll("line").data(this._simulationLinks).join("line").attr("class",d=>d.source.name+" "+d.target.name).attr("x1",d=>d.source.x).attr("y1",d=>d.source.y).attr("x2",d=>d.target.x).attr("y2",d=>d.target.y).attr("stroke-width",BombeMenu.LINK_STROKE_WIDTH).attr("stroke","grey"),this._edgeAnchor.selectAll("text").data(this._simulationLinks).join("text").text(d=>d.label.name).attr("class",d=>d.source.name+" "+d.target.name).attr("font-family","Courier New").attr("font-size",BombeMenu.LABEL_FONT_SIZE).attr("font-weight","bold").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("x",d=>d.label.x).attr("y",d=>d.label.y);var t=this._svgRoot.node().getBBox();this._svgRoot.attr("viewBox",`${t.x-10} ${t.y-10} ${t.width+20} `+(t.height+20))}complexRender(){this._clearRender();for(const s of this._simulationLinks)s.sourcePos=Vec.from(s.source),s.targetPos=Vec.from(s.target),s.linkVec=s.sourcePos.vectorTo(s.targetPos),s.parallelUnit=s.linkVec.norm(),s.perpUnit=s.parallelUnit.rotate(Math.PI/2),s.parallelOffset=s.perpUnit.mult(BombeMenu.LINK_STROKE_WIDTH),s.sourceSteckerPos=s.sourcePos.add(s.linkVec.div(BombeMenu.STECKER_POSITION_FACTOR)),s.targetSteckerPos=s.targetPos.sub(s.linkVec.div(BombeMenu.STECKER_POSITION_FACTOR));var t=[...this._simulationLinks.map(link=>({link:link,node:link.source,otherNode:link.target,steckerPos:link.sourceSteckerPos,steckerName:this.steckerAlphabet.charAt(this.alphabet.indexOf(link.source.name))})),...this._simulationLinks.map(link=>({link:link,node:link.target,otherNode:link.source,steckerPos:link.targetSteckerPos,steckerName:this.steckerAlphabet.charAt(this.alphabet.indexOf(link.target.name))}))],e=(this._nodeAnchor.selectAll("circle").data(this._simulationLetterNodes).join("circle").attr("class",d=>d.name).attr("r",BombeMenu.NODE_RADIUS).attr("fill","lightgrey").attr("stroke-width",BombeMenu.LINK_STROKE_WIDTH).attr("stroke","grey").attr("cx",d=>d.x).attr("cy",d=>d.y),this._nodeAnchor.selectAll("text").data(this._simulationLetterNodes).join("text").attr("class",d=>d.name).text(d=>d.name).attr("font-family","Courier New").attr("font-size",BombeMenu.NODE_FONT_SIZE).attr("font-weight","bold").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("x",d=>d.x).attr("y",d=>d.y),this._steckerAnchor.selectAll("line").data(t).enter("line")),e=(e.append("line").attr("class",d=>d.node.name+" "+d.otherNode.name).attr("x1",d=>d.node.x+d.link.parallelOffset.x).attr("y1",d=>d.node.y+d.link.parallelOffset.y).attr("x2",d=>d.steckerPos.x+d.link.parallelOffset.x).attr("y2",d=>d.steckerPos.y+d.link.parallelOffset.y).attr("stroke-width",BombeMenu.LINK_STROKE_WIDTH).attr("stroke","grey"),e.append("line").attr("class",d=>d.node.name+" "+d.otherNode.name).attr("x1",d=>d.node.x-d.link.parallelOffset.x).attr("y1",d=>d.node.y-d.link.parallelOffset.y).attr("x2",d=>d.steckerPos.x-d.link.parallelOffset.x).attr("y2",d=>d.steckerPos.y-d.link.parallelOffset.y).attr("stroke-width",BombeMenu.LINK_STROKE_WIDTH).attr("stroke","grey"),this._steckerAnchor.selectAll("circle").data(t).join("circle").attr("class",d=>d.node.name+" "+d.otherNode.name).attr("r",BombeMenu.STECKER_RADIUS).attr("fill","white").attr("stroke-width",BombeMenu.LINK_STROKE_WIDTH).attr("stroke","grey").attr("cx",d=>d.steckerPos.x).attr("cy",d=>d.steckerPos.y),this._steckerAnchor.selectAll("text").data(t).join("text").attr("class",d=>d.node.name+" "+d.otherNode.name).text(d=>d.steckerName).attr("font-family","Courier New").attr("font-size",BombeMenu.STECKER_FONT_SIZE).attr("font-weight","bold").attr("fill","red").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("x",d=>d.steckerPos.x).attr("y",d=>d.steckerPos.y),this._edgeAnchor.selectAll("path").data(this._simulationLinks).join("path").attr("class",d=>d.source.name+" "+d.target.name).attr("d",d=>BombeMenu._createWavyPath(d.sourceSteckerPos,d.targetSteckerPos,BombeMenu.STECKER_LINK_WAVELENGTH,BombeMenu.STECKER_LINK_AMPLITUDE)).attr("stroke-width",BombeMenu.LINK_STROKE_WIDTH).attr("stroke","grey").attr("fill","none"),this._edgeAnchor.selectAll("text").data(this._simulationLinks).join("text").attr("class",d=>d.source.name+" "+d.target.name).text(d=>d.label.name).attr("font-family","Courier New").attr("font-size",BombeMenu.LABEL_FONT_SIZE).attr("font-weight","bold").attr("dominant-baseline","middle").attr("text-anchor","middle").attr("x",d=>d.label.x).attr("y",d=>d.label.y),this._svgRoot.node().getBBox());this._svgRoot.attr("viewBox",`${e.x-10} ${e.y-10} ${e.width+20} `+(e.height+20))}showNode(char,showLinks=!0){if(this._nodeAnchor.selectAll("."+char).attr("visibility","visible"),showLinks){const t=this._nodeAnchor;this._steckerAnchor.selectAll("."+char).each(function(d,i){"hidden"!==t.select("."+d.node.name).attr("visibility")&&"hidden"!==t.select("."+d.otherNode.name).attr("visibility")&&this.setAttribute("visibility","visible")}),this._edgeAnchor.selectAll("."+char).each(function(d,i){"hidden"!==t.select("."+d.source.name).attr("visibility")&&"hidden"!==t.select("."+d.target.name).attr("visibility")&&this.setAttribute("visibility","visible")})}}hideNode(char){this._nodeAnchor.selectAll("."+char).attr("visibility","hidden"),this._steckerAnchor.selectAll("."+char).attr("visibility","hidden"),this._edgeAnchor.selectAll("."+char).attr("visibility","hidden")}showAllNodes(showLinks){this._nodeAnchor.selectAll("*").attr("visibility","visible"),showLinks&&(this._steckerAnchor.selectAll("*").attr("visibility","visible"),this._edgeAnchor.selectAll("*").attr("visibility","visible"))}hideAllNodes(){this._nodeAnchor.selectAll("*").attr("visibility","hidden"),this._steckerAnchor.selectAll("*").attr("visibility","hidden"),this._edgeAnchor.selectAll("*").attr("visibility","hidden")}showLink(source,target){this._steckerAnchor.selectAll(`.${source}.`+target).attr("visibility","visible"),this._edgeAnchor.selectAll(`.${source}.`+target).attr("visibility","visible").each((d,i)=>{this._nodeAnchor.selectAll(`.${source},.`+target).attr("visibility","visible")})}hideLink(source,target){this._steckerAnchor.selectAll(`.${source}.`+target).attr("visibility","hidden"),this._edgeAnchor.selectAll(`.${source}.`+target).attr("visibility","hidden")}hideAllLinks(){this._steckerAnchor.selectAll("*").attr("visibility","hidden"),this._edgeAnchor.selectAll("*").attr("visibility","hidden")}static _createWavyPath(start,end,wavelength,amplitude){let e=`M ${start.x},${start.y} `;var s=Math.round(start.distanceTo(end)/(wavelength/2)),i=start.vectorTo(end).div(s),wavelength=i.rotate(Math.PI/2).mult(amplitude),start=i.add(wavelength).div(2);e+=`q ${start.x},${start.y} ${i.x},${i.y} `;for(let t=2;t<s;++t)e+=`t ${i.x},${i.y} `;return e}_countPaths(n,source,target){if(0===n)return source===target?1:0;if(source.marked)return 0;source.marked=!0;let t=0;for(const e of source.outgoing)t+=e.compound--*this._countPaths(n-1,e.target,target,e),++e.compound;for(const s of source.incoming)t+=s.compound--*this._countPaths(n-1,s.source,target,s),++s.compound;return source.marked=!1,t}_countCycles(n){let e=0;for(const t of this._simulationLetterNodes)t.marked=!1;for(let t=0;t<this._simulationLetterNodes.length-(n-1);++t)e+=this._countPaths(n,this._simulationLetterNodes[t],this._simulationLetterNodes[t]),this._simulationLetterNodes[t].marked=!0;return e/2}countCycles(){let e=0;for(let t=2;t<=this.plainText.length;++t)e+=this._countCycles(t);return e}classifyCycles(){var e=[0,0];for(let t=2;t<=this.plainText.length;++t)e.push(this._countCycles(t));return e}isConnected(){for(const s of this._simulationLetterNodes)s.marked=!1;for(var t=[this._simulationLetterNodes[0]];t.length;){var e=t.pop();for(const i of e.outgoing)i.target.marked||(i.target.marked=!0,t.push(i.target));for(const o of e.incoming)o.source.marked||(o.source.marked=!0,t.push(o.source))}for(const r of this._simulationLetterNodes)if(!r.marked)return!1;return!0}chooseTestRegister(){const t=this._simulationLetterNodes.slice().sort((x,y)=>y.edgeCount-x.edgeCount);var e=this.alphabet.indexOf(t[0].name),s=t.slice(1).filter(x=>!t[0].outgoing.find(y=>y.target===x)&&!t[0].incoming.find(y=>y.source===x));return 0!==s.length?[e,this.alphabet.indexOf(s[0].name)]:[e,this.alphabet.indexOf(t[1].name)]}_clearRender(){this._nodeAnchor.selectAll("*").remove(),this._steckerAnchor.selectAll("*").remove(),this._edgeAnchor.selectAll("*").remove()}destroy(){this._nodeAnchor.remove(),this._steckerAnchor.remove(),this._edgeAnchor.remove()}}class CribGenerator{requireConnectedMenu;requiredMenuCycleClassification;requireSelfSteckersInMenu;minFullBombeStops;maxFullBombeStops;minReducedBombeStops;maxReducedBombeStops;alphabet;steckerAlphabet;plainText;steckerings;cipherText;scramblerCasing;initialScramblerPositions;bombe;bombeMenu;_bombeSVG;_menuSVG;searchPromise;rotorWirings;constructor(alphabet,steckerAlphabet,plainText,steckerings,requireConnectedMenu,requiredMenuCycleClassification,requireSelfSteckersInMenu,minFullBombeStops,maxFullBombeStops,minReducedBombeStops,maxReducedBombeStops){this.alphabet=alphabet,this.steckerAlphabet=steckerAlphabet,this.plainText=plainText,this.steckerings=steckerings.slice(),this.requireConnectedMenu=requireConnectedMenu,this.requiredMenuCycleClassification=requiredMenuCycleClassification,this.requireSelfSteckersInMenu=requireSelfSteckersInMenu,this.minFullBombeStops=minFullBombeStops,this.maxFullBombeStops=maxFullBombeStops,this.minReducedBombeStops=minReducedBombeStops,this.maxReducedBombeStops=maxReducedBombeStops,this._bombeSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._menuSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.searchPromise=this.search()}async search(){for(;;){this.scramblerCasing=new ScramblerCasing([Scrambler.randomScrambler(this.alphabet.length),Scrambler.randomScrambler(this.alphabet.length),Scrambler.randomScrambler(this.alphabet.length),Scrambler.randomReflector(this.alphabet.length)]);for(let t=0;t<this.alphabet.length**3;++t){this.bombe&&this.bombe.destroy(),this.bombeMenu&&this.bombeMenu.destroy(),this.scramblerCasing.rotation=t,this.initialScramblerPositions=this.scramblerCasing.rotations,this.cipherText=this.scramblerCasing.encodeCrib(this.alphabet,this.plainText,this.steckerings),this.bombeMenu=new BombeMenu(d3.select(this._menuSVG),this.alphabet,this.steckerAlphabet,this.plainText,this.cipherText);let e=!1;for(let t=0;t<this.steckerings.length;++t)if(this.steckerings[t]===t&&!this.plainText.includes(this.alphabet.charAt(t))&&!this.cipherText.includes(this.alphabet.charAt(t))){e=!0;break}if(!e&&(this.bombeMenu.isConnected()||!this.requireConnectedMenu)){var s=this.bombeMenu.classifyCycles();let e=!1;for(let t=0;t<Math.min(this.plainText.length,this.requiredMenuCycleClassification.length);++t)if(s[t]!==this.requiredMenuCycleClassification[t]){e=!0;break}if(!e){var[i,o]=this.bombeMenu.chooseTestRegister();this.bombe=new Bombe(d3.select(this._bombeSVG),this.alphabet,this.steckerAlphabet,!0,i,1/0),this.bombe.movementDuration=0,this.bombe.addDrumColumnsFromMenu(this.bombeMenu,this.scramblerCasing);let e=0;try{let t=0;for(;;)t=await this.bombe.search(o,t,1e5),++e}catch{}if(console.log("Full: "+e),!(e<this.minFullBombeStops||e>this.maxFullBombeStops)){this.bombe.dboard=!1;let e=0;try{let t=0;for(;;)t=await this.bombe.search(o,t,1e5),++e}catch{}if(console.log("Reduced: "+e),!(e<this.minReducedBombeStops||e>this.maxReducedBombeStops)){this.rotorWirings=new Array(4);for(let t=0;t<4;++t)this.rotorWirings[t]=this.scramblerCasing.scramblers[t].toString(this.alphabet);return}}}}}}}}class PlugColumn{alphabet;_liveWireAnchor;_deadWireAnchor;_junctionAnchor;_plugs=[];_cables=[];_pos;_truePos;_animationSpeed;_configureViewBox;static RAW_WIRE_SPACING=4;static CABLE_SPACING_FACTOR=1.7;static PLUG_COLUMN_SPACING_FACTOR=1.7;static CABLE_STYLES=new Styles("darkred","black",2,1);static PLUG_STYLES=new Styles("black","black",2,1.5);static MOVEMENT_DURATION=350;_rawWireSpacing;_cableWidth;_cableSpacing;_plugColumnSpacing;_actualCableWidth;_actualCableSeparation;_actualColumnSeparation;movementDuration=0;_movementAnimationAnchor;_movementQueue=Promise.resolve();constructor(liveWireAnchor,deadWireAnchor,junctionAnchor,alphabet,adjacent,animationSpeed,configureViewBox=()=>{}){this.alphabet=alphabet,this._liveWireAnchor=liveWireAnchor,this._deadWireAnchor=deadWireAnchor,this._junctionAnchor=junctionAnchor,this._animationSpeed=animationSpeed,this._configureViewBox=configureViewBox,this._movementAnimationAnchor=junctionAnchor.append("defs"),this._rawWireSpacing=PlugColumn.RAW_WIRE_SPACING,this._cableWidth=this._rawWireSpacing*this.alphabet.length,this._cableSpacing=this._cableWidth*PlugColumn.CABLE_SPACING_FACTOR,this._plugColumnSpacing=this._cableWidth*PlugColumn.PLUG_COLUMN_SPACING_FACTOR,this._actualCableWidth=this._cableWidth-this._rawWireSpacing,this._actualCableSeparation=this._cableWidth*(PlugColumn.CABLE_SPACING_FACTOR-1)+this._rawWireSpacing,this._actualColumnSeparation=this._plugColumnSpacing-this._actualCableWidth;var e=new Array(this.alphabet.length).fill(new Vec);for(let t=0;t<this.alphabet.length;++t)this._plugs.push(new Plug(this._junctionAnchor,this.alphabet,new Vec,e,HIDDEN_STYLES));for(let t=0;t<this.alphabet.length;++t)this._cables.push(new Cable(this._liveWireAnchor,this._deadWireAnchor,this.alphabet,this._plugs[t],null,animationSpeed,PlugColumn.CABLE_STYLES));this._setAdjacency(adjacent)}get pos(){return this._pos}set pos(pos){const s=this._pos;this._pos=pos,0===this.movementDuration?this._positionColumn(pos):(this._movementQueue=this._movementQueue.then(()=>{const e=s.interpolateTo(pos);return this._movementAnimationAnchor.transition().duration(this.movementDuration).ease(d3.easeSinOut).tween("",()=>t=>this._positionColumn(e(t))).end().catch(()=>this._positionColumn(pos))}),this._movementAnimationAnchor.interrupt())}get plugs(){return Object.freeze(this._plugs.slice())}powerOn(plug,junction){return this._plugs[plug].powerOn(junction)}powerOff(plug,junction){return this._plugs[plug].powerOff(junction)}isPoweredOn(plug,junction){return this._plugs[plug].isPoweredOn(junction)}forceOffAll(){for(const t of this._plugs)t.forceOffAll();for(const e of this._cables)e.resetAnimations()}get animationSpeed(){return this._animationSpeed}set animationSpeed(animationSpeed){this._animationSpeed=animationSpeed;for(const t of this._cables)t.animationSpeed=this._animationSpeed}_setAdjacency(adjacent){if(adjacent)this._cables.forEach((cable,i)=>cable.into=adjacent._plugs[i]),this.pos=new Vec(adjacent._pos.x+this._plugColumnSpacing,adjacent._pos.y);else{for(const cable of this._cables)cable.into=null;this.pos=new Vec}}_positionColumn(pos){this._truePos=pos;for(let t=0;t<this.alphabet.length;++t)this._plugs[t].pos=new Vec(pos.x,pos.y+t*this._cableSpacing);this._configureViewBox()}destroy(){for(const t of this._plugs)t.destroy();for(const e of this._cables)e.destroy();this._movementAnimationAnchor.remove()}}class DBoardColumn extends PlugColumn{_enabled;_diagonalWires=[];static DIAGONAL_WIRE_STYLES=new Styles("darkred","black",1.5,1,1,.5);_disabledJunctionOffsets;_enabledJunctionOffsets;constructor(liveWireAnchor,deadWireAnchor,junctionAnchor,alphabet,adjacent,animationSpeed,configureViewBox,enabled=!0){super(liveWireAnchor,deadWireAnchor,junctionAnchor,alphabet,adjacent,animationSpeed,configureViewBox),this._disabledJunctionOffsets=[];for(let e=0;e<this.alphabet.length;++e){this._disabledJunctionOffsets.push([]);for(let t=0;t<this.alphabet.length;++t)this._disabledJunctionOffsets[e].push(new Vec(0,this._rawWireSpacing*t))}this._enabledJunctionOffsets=[];for(let e=0;e<this.alphabet.length;++e){this._enabledJunctionOffsets.push([]);for(let t=0;t<this.alphabet.length;++t)this._enabledJunctionOffsets[e].push(new Vec(t*this._cableSpacing+this._rawWireSpacing*Math.sqrt(2)*Math.min(e,t),t*this._rawWireSpacing))}this.enabled=enabled}get enabled(){return this._enabled}set enabled(enabled){if(this._enabled!==enabled)if(this._enabled=enabled,0===this.movementDuration)if(this._enabled){this._diagonalWires=[];for(let e=0;e<this.alphabet.length;++e){for(let t=e+1;t<this.alphabet.length;++t){var s=Math.min(e,t)%2==0;this._diagonalWires.push(new Wire(this._liveWireAnchor,this._deadWireAnchor,this._plugs[s?e:t].junctions[s?t:e],this._plugs[s?t:e].junctions[s?e:t],this._animationSpeed,DBoardColumn.DIAGONAL_WIRE_STYLES)),this._plugs[e].junctions[t].styles=PlugColumn.PLUG_STYLES,this._plugs[t].junctions[e].styles=PlugColumn.PLUG_STYLES}this._plugs[e].offsets=this._enabledJunctionOffsets[e]}}else{for(const t of this._diagonalWires)t.destroy();this._diagonalWires=[];for(let t=0;t<this.alphabet.length;++t)this._plugs[t].offsets=this._disabledJunctionOffsets[t],this._plugs[t].styles=HIDDEN_STYLES}else this._movementQueue=this._movementQueue.then(()=>{if(enabled){const i=Vec.interpolateVecArray(this._disabledJunctionOffsets,this._enabledJunctionOffsets),o=[];this._diagonalWires=[];for(let e=0;e<this.alphabet.length;++e)for(let t=e+1;t<this.alphabet.length;++t){var s=Math.min(e,t)%2==0;this._diagonalWires.push(new Wire(this._liveWireAnchor,this._deadWireAnchor,this._plugs[s?e:t].junctions[s?t:e],this._plugs[s?e:t].junctions[s?t:e].cloneWithoutConnections(),this._animationSpeed,DBoardColumn.DIAGONAL_WIRE_STYLES)),o.push(this._plugs[s?t:e].junctions[s?e:t])}const e=t=>{for(let e=0;e<this.alphabet.length;++e)this._plugs[e].offsets=i(t)[e];for(let e=0;e<this._diagonalWires.length;++e){var s=this._diagonalWires[e].outof.pos.interpolateTo(o[e].pos);this._diagonalWires[e].into.pos=s(Math.max(0,1.5*t-.5))}this._configureViewBox()};return this._movementAnimationAnchor.transition().duration(this.movementDuration).ease(d3.easeSinOut).tween("",()=>e).end().catch(()=>e(1)).then(()=>{for(let t=0;t<this._diagonalWires.length;++t)this._diagonalWires[t].into=o[t].absorb(this._diagonalWires[t].into),this._diagonalWires[t].outof.styles=PlugColumn.PLUG_STYLES,this._diagonalWires[t].into.styles=PlugColumn.PLUG_STYLES})}{const r=Vec.interpolateVecArray(this._enabledJunctionOffsets,this._disabledJunctionOffsets),n=[];for(const l of this._diagonalWires)n.push(l.into),l.into.styles=HIDDEN_STYLES,l.outof.styles=HIDDEN_STYLES,l.disconnectInto();const a=t=>{for(let e=0;e<this.alphabet.length;++e)this._plugs[e].offsets=r(t)[e];for(let e=0;e<this._diagonalWires.length;++e){var s=n[e].pos.interpolateTo(this._diagonalWires[e].outof.pos);this._diagonalWires[e].into.pos=s(Math.min(1,1.5*t))}this._configureViewBox()};return this._movementAnimationAnchor.transition().duration(this.movementDuration).ease(d3.easeSinOut).tween("",()=>a).end().catch(()=>a(1)).then(()=>{for(const t of this._diagonalWires)t.destroy();this._diagonalWires=[]})}}),this._movementAnimationAnchor.interrupt()}get animationSpeed(){return super.animationSpeed}set animationSpeed(animationSpeed){super.animationSpeed=animationSpeed;for(const t of this._diagonalWires)t.animationSpeed=this._animationSpeed}forceOffAll(){for(const t of this._diagonalWires)t.resetAnimation();super.forceOffAll()}_positionColumn(pos){super._positionColumn(pos),this._configureViewBox()}destroy(){for(const t of this._diagonalWires)t.destroy();super.destroy()}}class DrumColumn extends PlugColumn{_drum;_drumCables;_drumPlugs;_connectedTo=null;_svgDrum;static DRUM_SVG_FACTOR=.4;static DRUM_CABLE_STYLES=new Styles("darkred","black",1.5,1,1,.3);static DRUM_PLUG_STYLES=HIDDEN_STYLES;static DRUM_SVG_OPACITY=.5;static DRUM_SVG_COLOR="black";_svgDrumWidth;_svgDrumHeight;_drumPlugsSeparation;constructor(liveWireAnchor,deadWireAnchor,junctionAnchor,drumAnchor,alphabet,adjacent,animationSpeed,scramblers,connectedTo){super(liveWireAnchor,deadWireAnchor,junctionAnchor,alphabet,adjacent,animationSpeed),this._svgDrumWidth=this._actualCableWidth+this._rawWireSpacing,this._svgDrumHeight=this._actualCableWidth*DrumColumn.DRUM_SVG_FACTOR+this._rawWireSpacing,this._drumPlugsSeparation=this._actualCableWidth*DrumColumn.DRUM_SVG_FACTOR;var e=[];for(let t=0;t<this.alphabet.length;++t)e.push(new Vec(t*this._rawWireSpacing,t*this._rawWireSpacing));var s=[];for(let t=0;t<this.alphabet.length;++t)s.push(new Vec(t*this._rawWireSpacing,0));for(const i of this._plugs)i.offsets=e;this._drumPlugs=[new Plug(junctionAnchor,this.alphabet,new Vec,s,DrumColumn.DRUM_PLUG_STYLES),new Plug(junctionAnchor,this.alphabet,new Vec,s,DrumColumn.DRUM_PLUG_STYLES)],this._drumCables=[new Cable(liveWireAnchor,deadWireAnchor,this.alphabet,null,this._drumPlugs[0],animationSpeed,DrumColumn.DRUM_CABLE_STYLES),new Cable(liveWireAnchor,deadWireAnchor,this.alphabet,null,this._drumPlugs[1],animationSpeed,DrumColumn.DRUM_CABLE_STYLES)],this._drum=new Drum(liveWireAnchor,deadWireAnchor,this.alphabet,this._drumPlugs[0],this._drumPlugs[1],animationSpeed,DrumColumn.DRUM_CABLE_STYLES,scramblers),this._svgDrum=drumAnchor.append("rect").attr("width",this._svgDrumWidth).attr("height",this._svgDrumHeight).attr("rx",.5*this._rawWireSpacing).attr("fill",DrumColumn.DRUM_SVG_COLOR).attr("fill-opacity",DrumColumn.DRUM_SVG_OPACITY);const t=this;Object.defineProperty(this._drum,"connectedTo",{get(){return t.connectedTo},set(connectedTo){t.connectedTo=connectedTo},enumerable:!0,configurable:!0}),this.connectedTo=connectedTo}get connectedTo(){return this._connectedTo}set connectedTo(connectedTo){if(!Array.isArray(connectedTo)||2!==connectedTo.length||!Number.isInteger(connectedTo[0])||!Number.isInteger(connectedTo[0])||connectedTo[0]===connectedTo[1])throw new Error("DrumColumn.connectedTo: Invalid type of connectedTo: expected int array of length 2, with neither elements equal");if(connectedTo[0]<0||connectedTo[0]>=this.alphabet.length||connectedTo[1]<0||connectedTo[1]>=this.alphabet.length)throw new Error("DrumColumn.connectedTo: Cable indices out of bounds");(connectedTo=connectedTo.slice())[1]<connectedTo[0]&&connectedTo.reverse();const h=this._connectedTo?this._connectedTo.slice():null;this._connectedTo=Object.freeze(connectedTo),h&&0!==this.movementDuration?(this._movementQueue=this._movementQueue.then(()=>{const e=[this._drumCables[0].disconnectOutof(),this._drumCables[1].disconnectOutof()];this._plugs[h[0]].styles=HIDDEN_STYLES,this._plugs[h[1]].styles=HIDDEN_STYLES;var s=connectedTo[1]-connectedTo[0],s=Math.floor(s/2),s=this._plugs[connectedTo[1]-s],i=s.pos.y-.5*this._actualCableSeparation,s=[new Vec(s.pos.x,i-.5*this._drumPlugsSeparation),new Vec(s.pos.x,i+.5*this._drumPlugsSeparation)],i=new Vec(parseFloat(this._svgDrum.attr("x")),parseFloat(this._svgDrum.attr("y"))),o=s[0].sub(new Vec(.5*this._rawWireSpacing));const r=[e[0].pos.interpolateTo(this._plugs[connectedTo[0]].pos),e[1].pos.interpolateTo(this._plugs[connectedTo[1]].pos)],n=[this._drumPlugs[0].pos.interpolateTo(s[0]),this._drumPlugs[1].pos.interpolateTo(s[1])],a=i.interpolateTo(o),l=t=>{e[0].pos=r[0](t),e[1].pos=r[1](t),this._drumPlugs[0].pos=n[0](t),this._drumPlugs[1].pos=n[1](t),this._svgDrum.attr("x",a(t).x).attr("y",a(t).y)};return this._movementAnimationAnchor.transition().duration(this.movementDuration).ease(d3.easeSinOut).tween("",()=>l).end().catch(()=>l(1)).then(()=>{this._plugs[connectedTo[0]].absorb(e[0]),this._plugs[connectedTo[1]].absorb(e[1]),this._plugs[connectedTo[0]].styles=PlugColumn.PLUG_STYLES,this._plugs[connectedTo[1]].styles=PlugColumn.PLUG_STYLES})}),this._movementAnimationAnchor.interrupt()):(h&&(this._plugs[h[0]].styles=HIDDEN_STYLES,this._plugs[h[1]].styles=HIDDEN_STYLES),this._drumCables[0].outof=this._plugs[this._connectedTo[0]],this._drumCables[1].outof=this._plugs[this._connectedTo[1]],this._plugs[this._connectedTo[0]].styles=PlugColumn.PLUG_STYLES,this._plugs[this._connectedTo[1]].styles=PlugColumn.PLUG_STYLES,this._positionDrum())}get drum(){return this._drum}get animationSpeed(){return super.animationSpeed}set animationSpeed(animationSpeed){super.animationSpeed=animationSpeed,this._drumCables[0].animationSpeed=this._animationSpeed,this._drumCables[1].animationSpeed=this._animationSpeed,this._drum.animationSpeed=this._animationSpeed}forceOffAll(){this._drumCables[0].resetAnimations(),this._drumCables[1].resetAnimations(),this._drumPlugs[0].forceOffAll(),this._drumPlugs[1].forceOffAll(),this._drum.resetAnimations(),super.forceOffAll()}_positionColumn(pos){super._positionColumn(pos),this._positionDrum()}_positionDrum(){var t,e;this._connectedTo&&(t=this._connectedTo[1]-this._connectedTo[0],t=Math.floor(t/2),e=(t=this._plugs[this._connectedTo[1]-t]).pos.y-.5*this._actualCableSeparation,this._drumPlugs[0].pos=new Vec(t.pos.x,e-.5*this._drumPlugsSeparation),this._drumPlugs[1].pos=new Vec(t.pos.x,e+.5*this._drumPlugsSeparation),this._svgDrum.attr("x",this._drumPlugs[0].pos.x-.5*this._rawWireSpacing).attr("y",this._drumPlugs[0].pos.y-.5*this._rawWireSpacing))}destroy(){this._svgDrum.remove(),this._drumCables[0].destroy(),this._drumCables[1].destroy(),this._drumPlugs[0].destroy(),this._drumPlugs[1].destroy(),this._drum.destroy(),super.destroy()}}class TestRegisterColumn extends PlugColumn{steckerAlphabet;_svgTestRegister;_testRegisterIndex;_wireLabels;_cableLabels;static WIRE_LABEL_FONT_SIZE_FACTOR=2.1;static CABLE_LABEL_FONT_SIZE_FACTOR=.8;static WIRE_LABEL_CLOSE_SPACING_FACTOR=1;static WIRE_LABEL_FAR_SPACING_FACTOR=1.9;static TEST_REGISTER_SVG_OPACITY=.5;static TEST_REGISTER_SVG_COLOR="black";static LABEL_FONTS="Courier New";_wireLabelFontSize;_cableLabelFontSize;_wireLabelCloseOffset;_wireLabelFarOffset;constructor(liveWireAnchor,deadWireAnchor,junctionAnchor,labelAnchor,alphabet,steckerAlphabet,animationSpeed,configureViewBox,testRegisterIndex){super(liveWireAnchor,deadWireAnchor,junctionAnchor,alphabet,null,animationSpeed,configureViewBox),this.steckerAlphabet=steckerAlphabet,this._wireLabelFontSize=this._rawWireSpacing*TestRegisterColumn.WIRE_LABEL_FONT_SIZE_FACTOR,this._cableLabelFontSize=this._cableWidth*TestRegisterColumn.CABLE_LABEL_FONT_SIZE_FACTOR,this._wireLabelCloseOffset=this._wireLabelFontSize*TestRegisterColumn.WIRE_LABEL_CLOSE_SPACING_FACTOR,this._wireLabelFarOffset=this._wireLabelFontSize*TestRegisterColumn.WIRE_LABEL_FAR_SPACING_FACTOR;for(const t of this._cables)t.destroy();this._cables=[];var e=[];for(let t=0;t<this.alphabet.length;++t)e.push(new Vec(0,t*this._rawWireSpacing));for(const s of this._plugs)s.offsets=e;this._svgTestRegister=labelAnchor.append("rect"),this._svgTestRegister.attr("height",this._rawWireSpacing*(this.alphabet.length+1)).attr("width",2*this._rawWireSpacing).attr("rx",.5*this._rawWireSpacing).attr("fill",TestRegisterColumn.TEST_REGISTER_SVG_COLOR).attr("fill-opacity",TestRegisterColumn.TEST_REGISTER_SVG_OPACITY),this._wireLabels=[];for(let e=0;e<this.alphabet.length;++e){this._wireLabels.push([]);for(let t=0;t<this.alphabet.length;++t)this._wireLabels[e].push(labelAnchor.append("text").text(this.alphabet.charAt(t)).attr("font-size",this._wireLabelFontSize).attr("font-weight","bold").attr("font-family",TestRegisterColumn.LABEL_FONTS).attr("dominant-baseline","middle").attr("fill","black"))}this._cableLabels=[];for(let t=0;t<this.alphabet.length;++t)this._cableLabels.push(labelAnchor.append("text").text(this.steckerAlphabet[t]).attr("font-size",this._cableLabelFontSize).attr("font-weight","bold").attr("font-family",TestRegisterColumn.LABEL_FONTS).attr("dominant-baseline","middle").attr("fill","grey"));this.testRegisterIndex=testRegisterIndex;for(let e=0;e<this.alphabet.length;++e)for(let t=0;t<this.alphabet.length;++t){const i=this._wireLabels[e][t];this._plugs[e].junctions[t].powerOn=function(){return i.attr("fill","red"),Junction.prototype.powerOn.call(this)},this._plugs[e].junctions[t].powerOff=function(){return i.attr("fill","black"),Junction.prototype.powerOff.call(this)},this._plugs[e].junctions[t].forceOff=function(){return i.attr("fill","black"),Junction.prototype.forceOff.call(this)}}}get testRegisterIndex(){return this._testRegisterIndex}set testRegisterIndex(testRegisterIndex){if(testRegisterIndex<0||testRegisterIndex>=this.alphabet.length)throw new Error("TestRegisterColumn.testRegisterIndex: Index out of bounds");this._testRegisterIndex=testRegisterIndex,this._positionTestRegister(),this._positionLabels()}get testRegister(){return this._plugs[this._testRegisterIndex]}_setAdjacency(adjacent){if(adjacent)throw new Error("TestRegister._setAdjacency: Cannot set adjacency of a test register - it has no adjacent column");super._setAdjacency(adjacent)}_positionColumn(pos){super._positionColumn(pos),this._positionTestRegister(),this._positionLabels(),this._configureViewBox()}_positionTestRegister(){var t;this._svgTestRegister&&(t=this._plugs[this._testRegisterIndex],this._svgTestRegister.attr("x",t.pos.x-this._rawWireSpacing).attr("y",t.pos.y-this._rawWireSpacing))}_positionLabels(){if(this._wireLabels)for(let e=0;e<this.alphabet.length;++e){for(let t=0;t<this.alphabet.length;++t)this._wireLabels[e][t].attr("x",this._plugs[e].junctions[t].pos.x-(t%2?this._wireLabelFarOffset:this._wireLabelCloseOffset)-this._rawWireSpacing*(this._testRegisterIndex===e?1:0)).attr("y",this._plugs[e].junctions[t].pos.y);this._cableLabels[e].attr("x",this._plugs[e].pos.x-this._wireLabelFarOffset-this._rawWireSpacing-this._cableLabelFontSize).attr("y",this._plugs[e].pos.y+this._actualCableWidth/2)}}destroy(){this._svgTestRegister.remove(),super.destroy()}}class Bombe{alphabet;steckerAlphabet;_svgRoot;_liveWireAnchor;_deadWireAnchor;_junctionAnchor;_drumAnchor;_labelAnchor;_dboard;_plugColumns=[];_animationSpeed;_movementDuration;_cancelAnimation=!1;_activeAnimation=null;_activeAnimationIndex;_cancelSearch=!1;_activeSearch=null;constructor(svgRoot,alphabet,steckerAlphabet,dboard,testRegisterIndex,animationSpeed=100){this._svgRoot=svgRoot,this.alphabet=alphabet,this.steckerAlphabet=steckerAlphabet,this._dboard=dboard,this._animationSpeed=animationSpeed,this._deadWireAnchor=this._svgRoot.append("g"),this._liveWireAnchor=this._svgRoot.append("g"),this._junctionAnchor=this._svgRoot.append("g"),this._drumAnchor=this._svgRoot.append("g"),this._labelAnchor=this._svgRoot.append("g"),this._plugColumns.push(new TestRegisterColumn(this._liveWireAnchor,this._deadWireAnchor,this._junctionAnchor,this._labelAnchor,this.alphabet,this.steckerAlphabet,this._animationSpeed,()=>this._configureSVGViewBox(),testRegisterIndex)),this._plugColumns.push(new DBoardColumn(this._liveWireAnchor,this._deadWireAnchor,this._junctionAnchor,this.alphabet,this._plugColumns[0],this._animationSpeed,()=>this._configureSVGViewBox(),this._dboard)),this.movementDuration=PlugColumn.MOVEMENT_DURATION,this._configureSVGViewBox()}get animationSpeed(){return this._animationSpeed}set animationSpeed(animationSpeed){this._animationSpeed=animationSpeed;for(const t of this._plugColumns)t.animationSpeed=this._animationSpeed}get movementDuration(){return this._movementDuration}set movementDuration(movementDuration){this._movementDuration=movementDuration;for(const t of this._plugColumns)t.movementDuration=this._movementDuration}get dboard(){return this._plugColumns[this._plugColumns.length-1].enabled}set dboard(dboard){this._plugColumns[this._plugColumns.length-1].enabled=dboard,this._configureSVGViewBox()}get testRegister(){return this._plugColumns[0].testRegister}get testRegisterIndex(){return this._plugColumns[0].testRegisterIndex}set testRegisterIndex(testRegisterIndex){this._plugColumns[0].testRegisterIndex=testRegisterIndex}get drums(){return Object.freeze(this._plugColumns.slice(1,this._plugColumns.length-1).map(column=>column.drum))}get numDrumColumns(){return this._plugColumns.length-2}addDrumColumn(scramblers,connectedTo,rotation=null,i=-1){if((i=-1===i?this._plugColumns.length-2:i)<0||i>=this._plugColumns.length-1)throw new Error("Bombe.addDrumColumn: index out of bounds");this._plugColumns.splice(++i,0,new DrumColumn(this._liveWireAnchor,this._deadWireAnchor,this._junctionAnchor,this._drumAnchor,this.alphabet,this._plugColumns[i-1],this._animationSpeed,scramblers,connectedTo)),null!==rotation&&(this._plugColumns[i].drum.rotation=rotation),this._plugColumns[i].movementDuration=this._movementDuration;for(let t=i+1;t<this._plugColumns.length;++t)this._plugColumns[t]._setAdjacency(this._plugColumns[t-1]);this._configureSVGViewBox()}deleteDrumColumn(i=-1){if((i=-1===i?this._plugColumns.length-3:i)<0||i>=this._plugColumns.length-2)throw new Error("Bombe.deleteDrumColumn: index out of bounds");this._plugColumns[++i].destroy(),this._plugColumns.splice(i,1);for(let t=i;t<this._plugColumns.length;++t)this._plugColumns[t]._setAdjacency(this._plugColumns[t-1]);this._configureSVGViewBox()}deleteAllDrumColumns(){for(let t=1;t<this._plugColumns.length-1;++t)this._plugColumns[t].destroy();this._plugColumns.splice(1,this._plugColumns.length-2),this._plugColumns[1]._setAdjacency(this._plugColumns[0]),this._configureSVGViewBox()}addDrumColumnsFromMenu(bombeMenu,scramblers,links=null){if(bombeMenu.alphabet!==this.alphabet)throw new Error("Bombe.addDrumColumnsFromMenu: Menu alphabet is not equal to that of the bombe");if(bombeMenu.plainText.length>this.alphabet.length)throw new Error("Bombe.addDrumColumnsFromMenu: Menu plaintext length is longer than the alphabet size. A middle-wheel-turnover is therefore guaranteed.");var t=this._movementDuration;this.movementDuration=0,this.deleteAllDrumColumns();for(const s of links=links||[...Array(bombeMenu.plainText.length).keys()]){var e=[this.alphabet.indexOf(bombeMenu.plainText.charAt(s)),this.alphabet.indexOf(bombeMenu.cipherText.charAt(s))];this.addDrumColumn(scramblers,e,s+1)}this.testRegisterIndex=bombeMenu.chooseTestRegister()[0],this.testRegisterIndex=bombeMenu.chooseTestRegister()[0],this.movementDuration=t}powerOn(wire){return this._activeAnimation?Promise.reject():(this._activeAnimationIndex=wire,this._activeAnimation=this.testRegister.powerOn(wire),this._activeAnimation)}powerOff(){if(!this._activeAnimation)return Promise.reject();const t=this._animationSpeed;return this.animationSpeed=null,this._activeAnimation=this._activeAnimation.catch(()=>{}).then(()=>this.animationSpeed=t).then(()=>this.testRegister.powerOff(this._activeAnimationIndex)).finally(()=>this._activeAnimation=null),this._activeAnimation}forceOffAll(){if(!this._activeAnimation)return Promise.reject();const t=this._animationSpeed;return this.animationSpeed=null,this._activeAnimation=this._activeAnimation.catch(()=>{}).then(()=>this.animationSpeed=t).then(()=>{for(const t of this._plugColumns)t.forceOffAll()}).finally(()=>this._activeAnimation=null),this._activeAnimation}get activeAnimation(){return this._activeAnimation}rotateAll(rotation){for(let t=1;t<this._plugColumns.length-1;++t)this._plugColumns[t].drum.inverseRotation+=rotation}search(wire,combs=0,render=1){if(0===combs&&this._activeSearch)return Promise.reject(combs);this._activeSearch=null;do{if(0===combs)this._cancelSearch=!1;else if(this._cancelSearch)return this._cancelSearch=!1,Promise.reject(combs);if(combs>=this.alphabet.length**3)return Promise.reject(combs);if(this._plugColumns.length-2==0)return Promise.reject(combs);if(this.rotateAll(1),++combs,this.testRegister.connectedSet(wire).size!==this.alphabet.length)return Promise.resolve(combs)}while(combs%render!=0);return this._activeSearch=new Promise(res=>setTimeout(res,0)).then(()=>this.search(wire,combs,render)),this._activeSearch}get activeSearch(){return this._activeSearch}cancelSearch(){return this._activeSearch?(this._cancelSearch=!0,this._activeSearch):Promise.reject(0)}_configureSVGViewBox(){var t=this._svgRoot.node().getBBox();this._svgRoot.attr("viewBox",`${t.x-10} ${t.y-10} ${t.width+20} `+(t.height+20))}destroy(){for(const t of this._plugColumns)t.destroy();this._liveWireAnchor.remove(),this._deadWireAnchor.remove(),this._junctionAnchor.remove(),this._drumAnchor.remove(),this._labelAnchor.remove()}}function addMixin(target,...sources){return sources.forEach(source=>{let e=Object.keys(source).reduce((descriptors,key)=>(descriptors[key]=Object.getOwnPropertyDescriptor(source,key),descriptors),{});Object.getOwnPropertySymbols(source).forEach(sym=>{var t=Object.getOwnPropertyDescriptor(source,sym);t.enumerable&&(e[sym]=t)}),Object.defineProperties(target,e)}),target}const fixBombeColumnsMixin={addDrumColumn(){throw new Error("Bombe.addDrumColumn: cannot add a drum column to a fixed example")},deleteDrumColumn(){throw new Error("Bombe.addDrumColumn: cannot delete a drum column from a fixed example")},deleteAllDrumColumns(){throw new Error("Bombe.deleteAllDrumColumns: cannot delete drum columns from a fixed example")},addDrumColumnsFromMenu(){throw new Error("Bombe.addDrumColumnsFromMenu: cannot add drum columns to a fixed example")}},fixBombeTestRegisterMixin={get testRegisterIndex(){return this._plugColumns[0].testRegisterIndex},set testRegisterIndex(testRegisterIndex){throw new Error("Bombe.testRegisterIndex: the test register is fixed for this example")}},fixBombeDBoardMixin={get dboard(){return this._dboard},set dboard(dboard){throw new Error("Bombe.dboard: the diagonal board is fixed for this example")}},disableBombeSearchMixin={search(){throw new Error("Bombe.search: searching is disabled for this example")},cancelSearch(){throw new Error("Bombe.cancelSearch: searching is disabled for this example")},get activeSearch(){return null}},fixDrumColumnConnectedToMixin={get connectedTo(){return this._connectedTo},set connectedTo(connectedTo){throw new Error("DrumColumn.connectedTo: drum connections cannot be changed for a fixed example")}};class MenuExample extends BombeMenu{static ALPHABET="abcdefgh";static STECKER_ALPHABET="\u03b1\u03b2\u03b3\u03b4\u03b5\u03b6\u03b7\u03b8";static MENU_PLAINTEXT="babbage";static MENU_CYPHERTEXT="egffbhg";constructor(menuSVG,complexRender=!1){super(menuSVG,MenuExample.ALPHABET,MenuExample.STECKER_ALPHABET,MenuExample.MENU_PLAINTEXT,MenuExample.MENU_CYPHERTEXT,complexRender)}}class IntroductionBombe extends Bombe{static ALPHABET="abcdefgh";static STECKER_ALPHABET="\u03b1\u03b2\u03b3\u03b4\u03b5\u03b6\u03b7\u03b8";static SCRAMBLERS=new ScramblerCasing([Scrambler.fromString("egcdabfh",IntroductionBombe.ALPHABET),Scrambler.fromString("aebhdgcf",IntroductionBombe.ALPHABET),Scrambler.fromString("cdfghbae",IntroductionBombe.ALPHABET),Scrambler.fromString("cgahfebd",IntroductionBombe.ALPHABET)]);static DIAGONAL_BOARD_POS=new Vec(250,0);static ALPHA_SUBSCRIPT_FONT_SIZE_FACTOR=2;static ALPHA_IN_SHIFT=15;_drumCount;constructor(bombeSVG,drumCount,animationSpeed=100){if(super(bombeSVG,IntroductionBombe.ALPHABET,IntroductionBombe.STECKER_ALPHABET,!1,2,animationSpeed),drumCount<(this.movementDuration=0)||1<drumCount)throw new Error("IntroductionBombe.constructor: drum count type specified");this.addDrumColumn(IntroductionBombe.SCRAMBLERS,[0,1]),this._plugColumns[1]._positionColumn(IntroductionBombe.DIAGONAL_BOARD_POS.div(new Vec(2,1)).sub(new Vec(this._cableWidth,0))),this.drumCount=drumCount,this._plugColumns[this._plugColumns.length-1]._positionColumn(IntroductionBombe.DIAGONAL_BOARD_POS);for(let s=0;s<this._plugColumns.length;++s)for(let e=2;e<8;++e)if(this._plugColumns[s]._plugs[e].destroy(),0!==s)this._plugColumns[s]._cables[e].destroy();else{this._plugColumns[s]._cableLabels[e].remove();for(let t=0;t<8;++t)this._plugColumns[s]._wireLabels[e][t].remove()}this._plugColumns[0]._svgTestRegister.remove(),this._plugColumns[0]._testRegisterIndex=0,this._plugColumns[0]._cableLabels[0].attr("x",parseFloat(this._plugColumns[0]._cableLabels[0].attr("x"))-IntroductionBombe.ALPHA_IN_SHIFT).append("tspan").attr("baseline-shift","sub").attr("font-size",this._plugColumns[0]._cableLabelFontSize/IntroductionBombe.ALPHA_SUBSCRIPT_FONT_SIZE_FACTOR).text("in"),addMixin(this,fixBombeColumnsMixin,fixBombeTestRegisterMixin,fixBombeDBoardMixin,disableBombeSearchMixin);for(let t=1;t<this._plugColumns.length-1;++t)addMixin(this._plugColumns[t],fixDrumColumnConnectedToMixin);this._configureSVGViewBox()}get drumCount(){return this._drumCount}set drumCount(drumCount){if(drumCount<0||1<drumCount)throw new Error("IntroductionBombe.drumCount: invalid range");this._drumCount=drumCount,this._drumCount?(this._plugColumns[1]._drumCables[0].styles=DrumColumn.DRUM_CABLE_STYLES,this._plugColumns[1]._drumCables[1].styles=DrumColumn.DRUM_CABLE_STYLES,this._plugColumns[1]._drumPlugs[0].styles=DrumColumn.DRUM_PLUG_STYLES,this._plugColumns[1]._drumPlugs[1].styles=DrumColumn.DRUM_PLUG_STYLES,this._plugColumns[1]._plugs[0].styles=PlugColumn.PLUG_STYLES,this._plugColumns[1]._plugs[1].styles=PlugColumn.PLUG_STYLES,this._plugColumns[1]._drum.styles=DrumColumn.DRUM_CABLE_STYLES,this._plugColumns[1]._svgDrum.style("visibility","visible"),this._plugColumns[1]._plugs[0].absorb(this._plugColumns[1]._drumCables[0].outof),this._plugColumns[1]._plugs[1].absorb(this._plugColumns[1]._drumCables[1].outof)):(this._plugColumns[1]._drumCables[0].styles=HIDDEN_STYLES,this._plugColumns[1]._drumCables[1].styles=HIDDEN_STYLES,this._plugColumns[1]._drumPlugs[0].styles=HIDDEN_STYLES,this._plugColumns[1]._drumPlugs[1].styles=HIDDEN_STYLES,this._plugColumns[1]._plugs[0].styles=HIDDEN_STYLES,this._plugColumns[1]._plugs[1].styles=HIDDEN_STYLES,this._plugColumns[1]._drum.styles=HIDDEN_STYLES,this._plugColumns[1]._svgDrum.style("visibility","hidden"),this._plugColumns[1]._drumCables[0].disconnectOutof(),this._plugColumns[1]._drumCables[1].disconnectOutof())}}class IntroductionSLHBombeExample extends IntroductionBombe{static ALPHA_OUT_EXTRA_SHIFT=5;constructor(bombeSVG,drumCount,animationSpeed=100){super(bombeSVG,drumCount,animationSpeed),this._plugColumns[0]._cableLabels[1].attr("x",parseFloat(this._plugColumns[0]._cableLabels[0].attr("x"))).text("\u03b1").append("tspan").attr("baseline-shift","sub").attr("font-size",this._plugColumns[0]._cableLabelFontSize/IntroductionSLHBombeExample.ALPHA_SUBSCRIPT_FONT_SIZE_FACTOR).text("in"),this._plugColumns[0]._cableLabels[0].attr("x",parseFloat(this._plugColumns[0]._cableLabels[0].attr("x"))-IntroductionSLHBombeExample.ALPHA_OUT_EXTRA_SHIFT).select("*").text("out")}}class SLHBombeExample extends Bombe{static ALPHABET="abcdefgh";static STECKER_ALPHABET="\u03b1\u03b2\u03b3\u03b4\u03b5\u03b6\u03b7\u03b8";static MENU_PLAINTEXT="babbage";static MENU_CYPHERTEXT="egffbhg";static MENU_SCRAMBLERS=new ScramblerCasing([Scrambler.fromString("egcdabfh",SLHBombeExample.ALPHABET),Scrambler.fromString("aebhdgcf",SLHBombeExample.ALPHABET),Scrambler.fromString("cdfghbae",SLHBombeExample.ALPHABET),Scrambler.fromString("cgahfebd",SLHBombeExample.ALPHABET)]);static LINK_INDICES=[4,0,6,1];static ALPHA_SUBSCRIPT_FONT_SIZE_FACTOR=2;static ALPHA_IN_SHIFT=15;static ALPHA_OUT_SHIFT=20;_bombeMenu;_extraPlugs;_extraCables;_extraWireLabels;_extraCableLabel;_drumCount;constructor(menuSVG,bombeSVG,drumCount,animationSpeed=100){super(bombeSVG,SLHBombeExample.ALPHABET,SLHBombeExample.STECKER_ALPHABET,!1,0,animationSpeed),this.movementDuration=0,menuSVG=menuSVG||d3.create("svg"),this._bombeMenu=new BombeMenu(menuSVG,SLHBombeExample.ALPHABET,SLHBombeExample.STECKER_ALPHABET,SLHBombeExample.MENU_PLAINTEXT,SLHBombeExample.MENU_CYPHERTEXT,!0),this.addDrumColumnsFromMenu(this._bombeMenu,SLHBombeExample.MENU_SCRAMBLERS,SLHBombeExample.LINK_INDICES),this.testRegisterIndex=0,this._extraPlugs=[],this._extraPlugs.push(new Plug(this._junctionAnchor,this.alphabet,this._plugColumns[0].plugs[0].pos.sub(new Vec(0,this._plugColumns[0]._cableSpacing)),this._plugColumns[0].plugs[0].offsets,HIDDEN_STYLES)),this._extraPlugs.push(new Plug(this._junctionAnchor,this.alphabet,this._plugColumns[this._plugColumns.length-2].plugs[0].pos.sub(new Vec(0,this._plugColumns[this._plugColumns.length-2]._cableSpacing)),this._plugColumns[this._plugColumns.length-2].plugs[0].offsets,PlugColumn.PLUG_STYLES)),this._extraPlugs.push(new Plug(this._junctionAnchor,this.alphabet,this._plugColumns[this._plugColumns.length-1].plugs[0].pos.sub(new Vec(0,this._plugColumns[this._plugColumns.length-1]._cableSpacing)),this._plugColumns[this._plugColumns.length-1].plugs[0].offsets,HIDDEN_STYLES)),this._extraCables=[],this._extraCables.push(new Cable(this._liveWireAnchor,this._deadWireAnchor,this.alphabet,this._extraPlugs[0],this._extraPlugs[1],this._animationSpeed,PlugColumn.CABLE_STYLES)),this._extraCables.push(new Cable(this._liveWireAnchor,this._deadWireAnchor,this.alphabet,this._extraPlugs[1],this._extraPlugs[2],this._animationSpeed,PlugColumn.CABLE_STYLES)),this._extraWireLabels=[];for(let t=0;t<this.alphabet.length;++t)this._extraWireLabels.push(this._labelAnchor.append("text").text(this.alphabet.charAt(t)).attr("font-size",this._plugColumns[0]._wireLabelFontSize).attr("font-weight","bold").attr("font-family",TestRegisterColumn.LABEL_FONTS).attr("dominant-baseline","middle").attr("fill","black").attr("x",parseFloat(this._plugColumns[0]._wireLabels[0][t].attr("x"))).attr("y",parseFloat(this._plugColumns[0]._wireLabels[0][t].attr("y"))-this._plugColumns[0]._cableSpacing));this._extraCableLabel=this._labelAnchor.append("text").text(this.steckerAlphabet[0]).attr("font-size",this._plugColumns[0]._cableLabelFontSize).attr("font-weight","bold").attr("font-family",TestRegisterColumn.LABEL_FONTS).attr("dominant-baseline","middle").attr("fill","grey").attr("x",parseFloat(this._plugColumns[0]._cableLabels[0].attr("x"))-SLHBombeExample.ALPHA_OUT_SHIFT).attr("y",parseFloat(this._plugColumns[0]._cableLabels[0].attr("y"))-this._plugColumns[0]._cableSpacing).append("tspan").attr("baseline-shift","sub").attr("font-size",this._plugColumns[0]._cableLabelFontSize/SLHBombeExample.ALPHA_SUBSCRIPT_FONT_SIZE_FACTOR).text("out"),this._plugColumns[0]._cableLabels[0].attr("x",parseFloat(this._plugColumns[0]._cableLabels[0].attr("x"))-SLHBombeExample.ALPHA_IN_SHIFT).append("tspan").attr("baseline-shift","sub").attr("font-size",this._plugColumns[0]._cableLabelFontSize/SLHBombeExample.ALPHA_SUBSCRIPT_FONT_SIZE_FACTOR).text("in"),this._plugColumns[0]._svgTestRegister.attr("y",parseFloat(this._plugColumns[0]._svgTestRegister.attr("y"))-this._plugColumns[0]._cableSpacing).attr("height",parseFloat(this._plugColumns[0]._svgTestRegister.attr("height"))+this._plugColumns[0]._cableSpacing),this._plugColumns[this._plugColumns.length-2]._drumCables[0].outof.styles=HIDDEN_STYLES,this._extraPlugs[1].absorb(this._plugColumns[this._plugColumns.length-2]._drumCables[0].disconnectOutof()),this.drumCount=drumCount;for(let t=0;t<this.alphabet.length;++t){const e=this._extraWireLabels[t];this._extraPlugs[0].junctions[t].powerOn=function(){return e.attr("fill","red"),Junction.prototype.powerOn.call(this)},this._extraPlugs[0].junctions[t].powerOff=function(){return e.attr("fill","black"),Junction.prototype.powerOff.call(this)},this._extraPlugs[0].junctions[t].forceOff=function(){return e.attr("fill","black"),Junction.prototype.forceOff.call(this)}}addMixin(this,fixBombeColumnsMixin,fixBombeTestRegisterMixin,fixBombeDBoardMixin,disableBombeSearchMixin);for(let t=1;t<this._plugColumns.length-1;++t)addMixin(this._plugColumns[t],fixDrumColumnConnectedToMixin);this._configureSVGViewBox()}get drumCount(){return this._drumCount}set drumCount(drumCount){if(drumCount<0||4<drumCount)throw new Error("SLHBombeExample.drumCount: invalid range");this._drumCount=drumCount;for(let t=0;t<this._drumCount;++t)(3===t?this._extraPlugs[1]:this._plugColumns[t+1]._plugs[this._plugColumns[t+1].connectedTo[0]]).absorb(this._plugColumns[t+1]._drumCables[0].outof),this._plugColumns[t+1]._plugs[this._plugColumns[t+1].connectedTo[1]].absorb(this._plugColumns[t+1]._drumCables[1].outof),this._plugColumns[t+1]._drumCables[0].styles=DrumColumn.DRUM_CABLE_STYLES,this._plugColumns[t+1]._drumCables[1].styles=DrumColumn.DRUM_CABLE_STYLES,this._plugColumns[t+1]._drumPlugs[0].styles=DrumColumn.DRUM_PLUG_STYLES,this._plugColumns[t+1]._drumPlugs[1].styles=DrumColumn.DRUM_PLUG_STYLES,this._plugColumns[t+1]._drumCables[0].outof.styles=PlugColumn.PLUG_STYLES,this._plugColumns[t+1]._drumCables[1].outof.styles=PlugColumn.PLUG_STYLES,this._plugColumns[t+1]._drum.styles=DrumColumn.DRUM_CABLE_STYLES,this._plugColumns[t+1]._svgDrum.style("visibility","visible");for(let t=this._drumCount;t<4;++t)this._plugColumns[t+1]._drumCables[0].styles=HIDDEN_STYLES,this._plugColumns[t+1]._drumCables[1].styles=HIDDEN_STYLES,this._plugColumns[t+1]._drumPlugs[0].styles=HIDDEN_STYLES,this._plugColumns[t+1]._drumPlugs[1].styles=HIDDEN_STYLES,this._plugColumns[t+1]._drumCables[0].outof.styles=HIDDEN_STYLES,this._plugColumns[t+1]._drumCables[1].outof.styles=HIDDEN_STYLES,this._plugColumns[t+1]._drum.styles=HIDDEN_STYLES,this._plugColumns[t+1]._svgDrum.style("visibility","hidden"),this._plugColumns[t+1]._drumCables[0].disconnectOutof(),this._plugColumns[t+1]._drumCables[1].disconnectOutof()}get animationSpeed(){return super.animationSpeed}set animationSpeed(animationSpeed){super.animationSpeed=animationSpeed;for(const t of this._extraCables)t.animationSpeed=this._animationSpeed}get outputTestRegister(){return this._extraPlugs[0]}forceOffAll(){return super.forceOffAll().then(()=>{for(const t of this._extraPlugs)t.forceOffAll();for(const e of this._extraCables)e.resetAnimations()})}destroy(){for(const t of this._extraPlugs)t.destroy();for(const e of this._extraCables)e.destroy();for(const s of this._extraWireLabels)s.remove();this._extraCableLabel.remove(),this._bombeMenu&&this._bombeMenu.destroy(),super.destroy()}}class FullBombeExample extends Bombe{static ALPHABET="abcdefgh";static STECKER_ALPHABET="\u03b1\u03b2\u03b3\u03b4\u03b5\u03b6\u03b7\u03b8";static MENU_PLAINTEXT="babbage";static MENU_CYPHERTEXT="egffbhg";static MENU_SCRAMBLERS=new ScramblerCasing([Scrambler.fromString("egcdabfh",FullBombeExample.ALPHABET),Scrambler.fromString("aebhdgcf",FullBombeExample.ALPHABET),Scrambler.fromString("cdfghbae",FullBombeExample.ALPHABET),Scrambler.fromString("cgahfebd",FullBombeExample.ALPHABET)]);static LINK_INDICES=[4,0,6,1,5,2,3];_bombeMenu;constructor(menuSVG,bombeSVG,type,animationSpeed=100){if(super(bombeSVG,FullBombeExample.ALPHABET,FullBombeExample.STECKER_ALPHABET,!1,0,animationSpeed),"empty"!==type&&"partial"!==type&&"full"!==type)throw new Error("FullBombeExample.constructor: invalid type specified");menuSVG=menuSVG||d3.create("svg"),this._bombeMenu=new BombeMenu(menuSVG,FullBombeExample.ALPHABET,FullBombeExample.STECKER_ALPHABET,FullBombeExample.MENU_PLAINTEXT,FullBombeExample.MENU_CYPHERTEXT,!0),"partial"===type?(this.addDrumColumnsFromMenu(this._bombeMenu,FullBombeExample.MENU_SCRAMBLERS,FullBombeExample.LINK_INDICES.slice(0,4)),this.testRegisterIndex=0):"full"===type&&this.addDrumColumnsFromMenu(this._bombeMenu,FullBombeExample.MENU_SCRAMBLERS,FullBombeExample.LINK_INDICES)}destroy(){this._bombeMenu.destroy(),super.destroy()}}class BombeUI extends Bombe{_controlsAnchor;_overlayAnchor;_overlays;_selectedOverlay=null;_defaultScramblers;_defaultReflectors;_defaultScramblerCasing;_dboardUI;_drumUI;_testRegisterUI;_placeholderUI;_currentInput=0;_scramblerReadouts=[0,0,0];static OVERLAY_ROUNDED_CORNERS=10;static ANIMATION_SPEED_MAX=800;static POWER_ANIMATION_TO_DISABLE="#bombeui-controls-test-register-text,#bombeui-controls-test-register-wrapper,#bombeui-controls-current-input-text,#bombeui-controls-current-input-wrapper,#bombeui-controls-rotate-all-text,#bombeui-controls-rotate-all-wrapper,#bombeui-controls-scrambler-readout-text,[id^=bombeui-controls-scrambler-readout-up],[id^=bombeui-controls-scrambler-readout-output],[id^=bombeui-controls-scrambler-readout-down],#bombeui-controls-search-button,#bombeui-controls-add-drum-button";static SEARCH_TO_DISABLE="#bombeui-controls-test-register-text,#bombeui-controls-test-register-wrapper,#bombeui-controls-current-input-text,#bombeui-controls-current-input-wrapper,#bombeui-controls-rotate-all-text,#bombeui-controls-rotate-all-wrapper,#bombeui-controls-scrambler-readout-text,[id^=bombeui-controls-scrambler-readout-up],[id^=bombeui-controls-scrambler-readout-output],[id^=bombeui-controls-scrambler-readout-down],#bombeui-controls-power-button,#bombeui-controls-animation-speed-text,#bombeui-controls-animation-speed-output,#bombeui-controls-animation-speed-slider,#bombeui-controls-add-drum-button";static DRUM_PROPERTIES_TO_WATCH=["scramblers","rotations","rotation","inverseRotation"];static ROMAN_NUMERALS=["I","II","III","IV","V"];constructor(svgRoot,controlsAnchor,alphabet,steckerAlphabet,dboard,testRegisterIndex,defaultScramblers,defaultReflectors,animationSpeed=100){super(svgRoot,alphabet,steckerAlphabet,dboard,testRegisterIndex,animationSpeed),this._defaultScramblers=defaultScramblers.map(s=>s.clone()),this._defaultReflectors=defaultReflectors.map(s=>s.clone());svgRoot=this._defaultScramblers.slice(0,3);svgRoot.push(this._defaultReflectors[0]),this._defaultScramblerCasing=new ScramblerCasing(svgRoot),this._controlsAnchor=controlsAnchor,this._overlayAnchor=this._svgRoot.append("g");const i=this._overlayAnchor.append("rect").classed("bombeui-overlay",!0).attr("rx",BombeUI.OVERLAY_ROUNDED_CORNERS),o=this._overlayAnchor.append("rect").classed("bombeui-overlay",!0).attr("rx",BombeUI.OVERLAY_ROUNDED_CORNERS),t=this._plugColumns[0],r=this._plugColumns[1],n=(i.on("click",()=>this._overlayClicked(i,t)),o.on("click",()=>this._overlayClicked(o,r)),t._positionColumn.bind(t));t._positionColumn=function(pos){n(pos);var pos=parseFloat(this._cableLabels[0].attr("x"))-this._actualColumnSeparation/2,t=this._plugs[0].pos.y-this._actualCableSeparation/2,e=this._plugs[0].pos.x-pos+this._plugColumnSpacing-this._actualColumnSeparation/2,s=this._cableSpacing*this.alphabet.length;i.attr("x",pos).attr("y",t).attr("width",e).attr("height",s)};alphabet=r._plugs[this.alphabet.length-1]._junctions[this.alphabet.length-1];const a=Object.getOwnPropertyDescriptor(alphabet,"pos")||Object.getOwnPropertyDescriptor(Junction.prototype,"pos");Object.defineProperty(alphabet,"pos",{configurable:!0,enumerable:!0,get:function(){return a.get.call(this)},set:function(pos){a.set.call(this,pos);var pos=r._truePos.x-r._actualColumnSeparation/2,t=r._truePos.y-r._actualCableSeparation/2,e=this.pos.x-pos+r._actualColumnSeparation/2,s=r._cableSpacing*r.alphabet.length;o.attr("x",pos).attr("y",t).attr("width",e).attr("height",s)}}),t._positionColumn(t.pos),r._positionColumn(r.pos),this._overlays=[],this._overlays.push(i),this._overlays.push(o),this._controlsAnchor.classed("bombeui-controls-container",!0),this._testRegisterUI=d3.create("template"),this._testRegisterUI.append("span").classed("bombeui-controls-separator",!0),this._testRegisterUI.append("p").attr("id","bombeui-controls-test-register-text").attr("class","bombeui-controls-text").text("Test Register");steckerAlphabet=this._testRegisterUI.append("div").attr("id","bombeui-controls-test-register-wrapper").attr("class","bombeui-controls-vertical-selector-wrapper"),steckerAlphabet.append("button").attr("id","bombeui-controls-test-register-up").attr("class","bombeui-controls-vertical-selector-button").text("\u25b2"),steckerAlphabet.append("span").attr("id","bombeui-controls-test-register-output").attr("class","bombeui-controls-vertical-selector-output"),steckerAlphabet.append("button").attr("id","bombeui-controls-test-register-down").attr("class","bombeui-controls-vertical-selector-button").text("\u25bc"),this._testRegisterUI.append("span").classed("bombeui-controls-separator",!0),this._testRegisterUI.append("p").attr("id","bombeui-controls-current-input-text").attr("class","bombeui-controls-text").text("Input Current At"),dboard=this._testRegisterUI.append("div").attr("id","bombeui-controls-current-input-wrapper").attr("class","bombeui-controls-vertical-selector-wrapper"),dboard.append("button").attr("id","bombeui-controls-current-input-up").attr("class","bombeui-controls-vertical-selector-button").text("\u25b2"),dboard.append("span").attr("id","bombeui-controls-current-input-output").attr("class","bombeui-controls-vertical-selector-output"),dboard.append("button").attr("id","bombeui-controls-current-input-down").attr("class","bombeui-controls-vertical-selector-button").text("\u25bc"),this._testRegisterUI.append("span").classed("bombeui-controls-separator",!0),this._testRegisterUI.append("p").attr("id","bombeui-controls-rotate-all-text").attr("class","bombeui-controls-text").text("Rotate All"),testRegisterIndex=this._testRegisterUI.append("div").attr("id","bombeui-controls-rotate-all-wrapper").attr("class","bombeui-controls-vertical-selector-wrapper");testRegisterIndex.append("button").attr("id","bombeui-controls-rotate-all-up").attr("class","bombeui-controls-vertical-selector-button").text("\u25b2"),testRegisterIndex.append("button").attr("id","bombeui-controls-rotate-all-down").attr("class","bombeui-controls-vertical-selector-button").text("\u25bc"),this._testRegisterUI.append("span").classed("bombeui-controls-separator",!0),this._testRegisterUI.append("p").attr("id","bombeui-controls-scrambler-readout-text").attr("class","bombeui-controls-text").text("Scrambler Readout");for(let t=0;t<3;++t){var e=this._testRegisterUI.append("div").attr("class","bombeui-controls-vertical-selector-wrapper");e.append("button").attr("id","bombeui-controls-scrambler-readout-up-"+t).attr("class","bombeui-controls-vertical-selector-button").text("\u25b2"),e.append("span").attr("id","bombeui-controls-scrambler-readout-output-"+t).attr("class","bombeui-controls-vertical-selector-output"),e.append("button").attr("id","bombeui-controls-scrambler-readout-down-"+t).attr("class","bombeui-controls-vertical-selector-button").text("\u25bc")}this._testRegisterUI.append("span").classed("bombeui-controls-separator",!0),this._testRegisterUI.append("p").attr("id","bombeui-controls-animation-speed-text").attr("class","bombeui-controls-text").text("Animation Speed"),this._testRegisterUI.append("span").attr("id","bombeui-controls-animation-speed-output").attr("class","bombeui-controls-vertical-slider-output"),this._testRegisterUI.append("div").attr("class","bombeui-controls-vertical-slider-wrapper").append("input").attr("type","range").attr("id","bombeui-controls-animation-speed-slider").attr("class","bombeui-controls-vertical-slider").attr("orientation","vertical").attr("min",0).attr("max",BombeUI.ANIMATION_SPEED_MAX).attr("step",1),this._testRegisterUI.append("span").classed("bombeui-controls-separator",!0),this._testRegisterUI.append("button").attr("id","bombeui-controls-power-button").attr("class","bombeui-controls-button").text("Power On"),this._testRegisterUI.append("span").classed("bombeui-controls-separator",!0),this._testRegisterUI.append("button").attr("id","bombeui-controls-search-button").attr("class","bombeui-controls-button").text("Search"),this._testRegisterUI.append("span").classed("bombeui-controls-separator",!0),this._testRegisterUI.append("button").attr("id","bombeui-controls-add-drum-button").attr("class","bombeui-controls-button").text("Insert Drum Column"),this._testRegisterUI.append("span").classed("bombeui-controls-separator",!0),this._dboardUI=d3.create("template"),this._dboardUI.append("span").classed("bombeui-controls-separator",!0),this._dboardUI.append("button").attr("id","bombeui-controls-dboard-button").attr("class","bombeui-controls-button"),this._dboardUI.append("span").classed("bombeui-controls-separator",!0),this._drumUI=d3.create("template"),this._drumUI.append("span").classed("bombeui-controls-separator",!0),this._drumUI.append("p").attr("class","bombeui-controls-text").text("Rotors");for(let t=0;t<3;++t){var s=this._drumUI.append("div").attr("class","bombeui-controls-vertical-selector-wrapper");s.append("button").attr("id","bombeui-controls-scrambler-up-"+t).attr("class","bombeui-controls-vertical-selector-button").text("\u25b2"),s.append("span").attr("id","bombeui-controls-scrambler-output-"+t).attr("class","bombeui-controls-vertical-selector-output"),s.append("button").attr("id","bombeui-controls-scrambler-down-"+t).attr("class","bombeui-controls-vertical-selector-button").text("\u25bc")}this._drumUI.append("span").classed("bombeui-controls-separator",!0),this._drumUI.append("p").attr("class","bombeui-controls-text").text("Rotations");for(let t=0;t<3;++t){var l=this._drumUI.append("div").attr("class","bombeui-controls-vertical-selector-wrapper");l.append("button").attr("id","bombeui-controls-rotation-up-"+t).attr("class","bombeui-controls-vertical-selector-button").text("\u25b2"),l.append("span").attr("id","bombeui-controls-rotation-output-"+t).attr("class","bombeui-controls-vertical-selector-output"),l.append("button").attr("id","bombeui-controls-rotation-down-"+t).attr("class","bombeui-controls-vertical-selector-button").text("\u25bc")}this._drumUI.append("span").classed("bombeui-controls-separator",!0),this._drumUI.append("p").attr("class","bombeui-controls-text").text("Reflector");animationSpeed=this._drumUI.append("div").attr("class","bombeui-controls-vertical-selector-wrapper"),animationSpeed.append("button").attr("id","bombeui-controls-reflector-up").attr("class","bombeui-controls-vertical-selector-button").text("\u25b2"),animationSpeed.append("span").attr("id","bombeui-controls-reflector-output").attr("class","bombeui-controls-vertical-selector-output"),animationSpeed.append("button").attr("id","bombeui-controls-reflector-down").attr("class","bombeui-controls-vertical-selector-button").text("\u25bc"),this._drumUI.append("span").classed("bombeui-controls-separator",!0),this._drumUI.append("p").attr("class","bombeui-controls-text").text("Drum Connections"),this._drumUI.append("span").attr("id","bombeui-controls-drum-connected-to-output-left").attr("class","bombeui-controls-vertical-slider-output-greek"),defaultScramblers=this._drumUI.append("div").attr("class","bombeui-controls-vertical-slider-wrapper");defaultScramblers.append("input").attr("type","range").attr("id","bombeui-controls-drum-connected-to-left").attr("class","bombeui-controls-vertical-slider").attr("orientation","vertical").attr("min",0).attr("max",this.alphabet.length-1).attr("step",1),defaultScramblers.clone(!0).select("input").attr("id","bombeui-controls-drum-connected-to-right").attr("class","bombeui-controls-vertical-slider"),this._drumUI.append("span").attr("id","bombeui-controls-drum-connected-to-output-right").attr("class","bombeui-controls-vertical-slider-output-greek"),this._drumUI.append("span").classed("bombeui-controls-separator",!0),this._drumUI.append("button").attr("id","bombeui-controls-delete-drum-button").attr("class","bombeui-controls-button").text("Delete Drum Column"),this._drumUI.append("span").classed("bombeui-controls-separator",!0),this._drumUI.append("button").attr("id","bombeui-controls-add-drum-button").attr("class","bombeui-controls-button").text("Insert Drum Column"),this._drumUI.append("span").classed("bombeui-controls-separator",!0),this._placeholderUI=d3.create("template"),this._placeholderUI.append("p").attr("class","bombeui-controls-placeholder-text").html("Click on part of the circuit to configure its settings.<br><br>You can run the Bombe through the test register menu, which is opened by clicking on the far left of the circuit.");const h=this._controlsAnchor;this._placeholderUI.selectAll(function(){return this.childNodes}).each(function(){h.node().appendChild(this.cloneNode(!0))})}addDrumColumn(scramblers,connectedTo,rotation=0,i=-1){super.addDrumColumn(scramblers,connectedTo,rotation,i),-1===i&&(i=this._plugColumns.length-3);const t=this._plugColumns[++i],s=t.drum,o=this._overlayAnchor.append("rect").classed("bombeui-overlay",!0).attr("rx",BombeUI.OVERLAY_ROUNDED_CORNERS),r=(this._overlays.splice(i,0,o),o.on("click",()=>this._overlayClicked(o,t)),t._positionColumn.bind(t)),e=(t._positionColumn=function(pos){r(pos);var pos=this._truePos.x-this._actualColumnSeparation/2,t=this._truePos.y-this._actualCableSeparation/2,e=this._plugColumnSpacing,s=this._cableSpacing*this.alphabet.length;o.attr("x",pos).attr("y",t).attr("width",e).attr("height",s)},t._drum=new Proxy(s,{set:(obj,prop,value)=>{if(obj[prop]=value,BombeUI.DRUM_PROPERTIES_TO_WATCH.includes(prop)&&this._selectedOverlay===o){for(let t=0;t<3;++t){var e=this._defaultScramblers.findIndex(x=>x.sameMapping(s.scramblers.scramblers[t]));if(e<0)throw new Error("BombeUI Drum Proxy: scrambler is not one of the defaults");this._controlsAnchor.select("#bombeui-controls-scrambler-output-"+t).text(BombeUI.ROMAN_NUMERALS[e]),this._controlsAnchor.select("#bombeui-controls-rotation-output-"+t).text(this.alphabet.toUpperCase()[s.rotations[t]])}obj=this._defaultReflectors.findIndex(x=>x.sameMapping(s.scramblers.scramblers[3]));if(obj<0)throw new Error("BombeUI Drum Proxy: reflector is not one of the defaults");this._controlsAnchor.select("#bombeui-controls-reflector-output").text(0===obj?"B":"C")}return!0}}),Object.getOwnPropertyDescriptor(t,"connectedTo")||Object.getOwnPropertyDescriptor(DrumColumn.prototype,"connectedTo"));Object.defineProperty(t,"connectedTo",{configurable:!0,enumerable:!0,get:()=>e.get.call(t),set:connectedTo=>{e.set.call(t,connectedTo),this._selectedOverlay===o&&(this._controlsAnchor.selectAll("[id^=bombeui-controls-drum-connected-to-output]").data([0,1]).text(i=>this.steckerAlphabet[connectedTo[i]]),this._controlsAnchor.selectAll("#bombeui-controls-drum-connected-to-left,#bombeui-controls-drum-connected-to-right").data([0,1]).property("value",i=>connectedTo[i]))}}),t._positionColumn(t.pos)}deleteDrumColumn(i=-1){super.deleteDrumColumn(i);var i=-1===i?this._overlays.length-2:i+1,t=this._overlays[i];this._overlays.splice(i,1)[0].remove(),t===this._selectedOverlay&&(2<this._overlays.length?this._overlayClicked(this._overlays[1===i?1:i-1],this._plugColumns[1===i?1:i-1]):this._overlayClicked(t,null))}deleteAllDrumColumns(){super.deleteAllDrumColumns();for(let t=1;t<this._overlays.length-1;++t)this._overlays[t].remove();this._overlays.splice(1,this._overlays.length-2),this._selectedOverlay&&!this._overlays.includes(this._selectedOverlay)&&this._overlayClicked(this._selectedOverlay,null)}powerOn(wire){return this._selectedOverlay!==this._overlays[0]&&this._overlayClicked(this._overlays[0],this._plugColumns[0]),this._overlayAnchor.style("pointer-events","none"),this._selectedOverlay&&this._selectedOverlay.transition().duration(100).ease(d3.easeLinear).style("opacity",0),this._controlsAnchor.selectAll(BombeUI.POWER_ANIMATION_TO_DISABLE).style("pointer-events","none").style("opacity",.5),this._controlsAnchor.select("#bombeui-controls-power-button").text("Power Off"),super.powerOn(wire)}powerOff(){this._selectedOverlay!==this._overlays[0]&&this._overlayClicked(this._overlays[0],this._plugColumns[0]);const t=this._controlsAnchor.select("#bombeui-controls-power-button").style("pointer-events","none").style("opacity",.5);return super.powerOff().finally(()=>{this._overlayAnchor.style("pointer-events","").style("opacity",""),this._controlsAnchor.selectAll(BombeUI.POWER_ANIMATION_TO_DISABLE).style("pointer-events","").style("opacity",""),this._selectedOverlay&&this._selectedOverlay.transition().duration(100).ease(d3.easeLinear).style("opacity",1),t.style("pointer-events","").style("opacity","").text("Power On")})}forceOffAll(){this._selectedOverlay!==this._overlays[0]&&this._overlayClicked(this._overlays[0],this._plugColumns[0]);const t=this._controlsAnchor.select("#bombeui-controls-power-button").style("pointer-events","none").style("opacity",.5);return super.forceOffAll().finally(()=>{this._overlayAnchor.style("pointer-events","").style("opacity",""),this._controlsAnchor.selectAll(BombeUI.POWER_ANIMATION_TO_DISABLE).style("pointer-events","").style("opacity",""),this._selectedOverlay&&this._selectedOverlay.transition().duration(100).ease(d3.easeLinear).style("opacity",1),t.style("pointer-events","").style("opacity","").text("Power On")})}rotateAll(rotation){super.rotateAll(rotation),this.inverseScramblerReadout+=rotation}search(wire,combs=0,render=1){this._selectedOverlay!==this._overlays[0]&&this._overlayClicked(this._overlays[0],this._plugColumns[0]),this._overlayAnchor.style("pointer-events","none");const t=this._controlsAnchor.selectAll(BombeUI.SEARCH_TO_DISABLE).style("pointer-events","none").style("opacity",.5),e=(this._selectedOverlay&&this._selectedOverlay.transition().duration(100).ease(d3.easeLinear).style("opacity",0),d3.select("#bombeui-controls-search-button").text("Cancel"));return super.search(wire,combs,render).finally(()=>{this._overlayAnchor.style("pointer-events","").style("opacity",""),t.style("pointer-events","").style("opacity",""),this._selectedOverlay&&this._selectedOverlay.transition().duration(100).ease(d3.easeLinear).style("opacity",1),e.text("Search")})}cancelSearch(){return this._selectedOverlay!==this._overlays[0]&&this._overlayClicked(this._overlays[0],this._plugColumns[0]),super.cancelSearch()}addDrumColumnsFromMenu(bombeMenu,scramblers,links=null){super.addDrumColumnsFromMenu(bombeMenu,scramblers,links),this.scramblerReadout=0}get currentInput(){return this._currentInput}set currentInput(currentInput){if(currentInput<0||currentInput>=this.alphabet.length)throw new Error("BombeUI.currentInput: out of range");this._currentInput=currentInput,this._selectedOverlay===this._overlays[0]&&this._controlsAnchor.select("#bombeui-controls-current-input-output").text(this.alphabet.charAt(this._currentInput))}get dboard(){return super.dboard}set dboard(dboard){super.dboard=dboard,this._selectedOverlay===this._overlays[this._overlays.length-1]&&this._controlsAnchor.select("#bombeui-controls-dboard-button").text(this.dboard?"Disable Diagonal Board":"Enable Diagonal Board")}get testRegisterIndex(){return super.testRegisterIndex}set testRegisterIndex(testRegisterIndex){super.testRegisterIndex=testRegisterIndex,this._selectedOverlay===this._overlays[0]&&this._controlsAnchor.select("#bombeui-controls-test-register-output").text(this.steckerAlphabet.charAt(this.testRegisterIndex))}get animationSpeed(){return super.animationSpeed}set animationSpeed(animationSpeed){super.animationSpeed=animationSpeed,this._selectedOverlay===this._overlays[0]&&(this._controlsAnchor.select("#bombeui-controls-animation-speed-slider").property("value",BombeUI.ANIMATION_SPEED_MAX-this.animationSpeed),this._controlsAnchor.select("#bombeui-controls-animation-speed-output").text(this.animationSpeed))}get scramblerReadout(){return this._scramblerReadouts[2]+this._scramblerReadouts[1]*this.alphabet.length+this._scramblerReadouts[0]*this.alphabet.length*this.alphabet.length}set scramblerReadout(scramblerReadout){this.scramblerReadouts=[Scrambler.nonNegativeMod(scramblerReadout/this.alphabet.length**2,this.alphabet.length),Scrambler.nonNegativeMod(scramblerReadout/this.alphabet.length**1,this.alphabet.length),Scrambler.nonNegativeMod(scramblerReadout/this.alphabet.length**0,this.alphabet.length)]}get inverseScramblerReadout(){return this._scramblerReadouts[0]+this._scramblerReadouts[1]*this.alphabet.length+this._scramblerReadouts[2]*this.alphabet.length*this.alphabet.length}set inverseScramblerReadout(inverseScramblerReadout){this.scramblerReadouts=[Scrambler.nonNegativeMod(inverseScramblerReadout/this.alphabet.length**0,this.alphabet.length),Scrambler.nonNegativeMod(inverseScramblerReadout/this.alphabet.length**1,this.alphabet.length),Scrambler.nonNegativeMod(inverseScramblerReadout/this.alphabet.length**2,this.alphabet.length)]}get scramblerReadouts(){return this._scramblerReadouts.slice()}set scramblerReadouts(scramblerReadouts){this._scramblerReadouts=scramblerReadouts.map(e=>Scrambler.nonNegativeMod(e,this.alphabet.length)),this._selectedOverlay===this._overlays[0]&&this._controlsAnchor.selectAll("[id^=bombeui-controls-scrambler-readout-output]").data([0,1,2]).text(i=>this.alphabet.toUpperCase().charAt(this._scramblerReadouts[i]))}_overlayClicked(overlay,column){if(this._selectedOverlay&&this._selectedOverlay.classed("bombeui-overlay-selected",!1),this._controlsAnchor.selectAll("*").remove(),this._selectedOverlay===overlay){this._selectedOverlay=null;const t=this._controlsAnchor;this._placeholderUI.selectAll(function(){return this.childNodes}).each(function(){t.node().appendChild(this.cloneNode(!0))})}else{this._selectedOverlay=overlay.classed("bombeui-overlay-selected",!0),this._controlsAnchor.select("*").remove();const e=this._controlsAnchor;if(column instanceof DBoardColumn)this._dboardUI.selectAll(function(){return this.childNodes}).each(function(){e.node().appendChild(this.cloneNode(!0))}),this._controlsAnchor.select("#bombeui-controls-dboard-button").on("click",()=>this.dboard=!this.dboard).text(this.dboard?"Disable Diagonal Board":"Enable Diagonal Board");else if(column instanceof TestRegisterColumn){this._testRegisterUI.selectAll(function(){return this.childNodes}).each(function(){e.node().appendChild(this.cloneNode(!0))});var overlay=this._controlsAnchor.select("#bombeui-controls-test-register-up"),s=this._controlsAnchor.select("#bombeui-controls-test-register-output"),o=this._controlsAnchor.select("#bombeui-controls-test-register-down"),overlay=(overlay.on("click",()=>this.testRegisterIndex=(this.testRegisterIndex+1)%this.alphabet.length),o.on("click",()=>this.testRegisterIndex=(this.testRegisterIndex-1+this.alphabet.length)%this.alphabet.length),s.text(this.steckerAlphabet.charAt(this.testRegisterIndex)),this._controlsAnchor.select("#bombeui-controls-current-input-up")),o=this._controlsAnchor.select("#bombeui-controls-current-input-output"),s=this._controlsAnchor.select("#bombeui-controls-current-input-down");overlay.on("click",()=>this.currentInput=(this._currentInput+1)%this.alphabet.length),s.on("click",()=>this.currentInput=(this._currentInput-1+this.alphabet.length)%this.alphabet.length),o.text(this.alphabet.charAt(this.currentInput)),this._controlsAnchor.select("#bombeui-controls-rotate-all-up").on("click",()=>this.rotateAll(1)),this._controlsAnchor.select("#bombeui-controls-rotate-all-down").on("click",()=>this.rotateAll(-1));{overlay=this._controlsAnchor.selectAll("[id^=bombeui-controls-scrambler-readout-up]"),s=this._controlsAnchor.selectAll("[id^=bombeui-controls-scrambler-readout-output]"),o=this._controlsAnchor.selectAll("[id^=bombeui-controls-scrambler-readout-down]");let t=(i,dir)=>this.scramblerReadouts=this.scramblerReadouts.map((e,j)=>i===j?e+dir:e);overlay.data([0,1,2]).on("click",(e,i)=>t(i,1)),o.data([0,1,2]).on("click",(e,i)=>t(i,-1)),s.data([0,1,2]).text(i=>this.alphabet.toUpperCase().charAt(this.scramblerReadouts[i]))}{const r=this._controlsAnchor.select("#bombeui-controls-animation-speed-output"),n=this._controlsAnchor.select("#bombeui-controls-animation-speed-slider").on("input",()=>r.text(BombeUI.ANIMATION_SPEED_MAX-parseFloat(n.property("value"))));n.on("change",()=>this.animationSpeed=BombeUI.ANIMATION_SPEED_MAX-parseFloat(n.property("value"))),n.property("value",BombeUI.ANIMATION_SPEED_MAX-this.animationSpeed),r.text(this.animationSpeed)}this._controlsAnchor.select("#bombeui-controls-power-button").on("click",()=>{this._activeAnimation?this.powerOff():this.powerOn(this._currentInput)}),this._controlsAnchor.select("#bombeui-controls-search-button").on("click",()=>{this._activeSearch?this.cancelSearch():this.search(this.currentInput,0,this.alphabet.length+1)}),this._controlsAnchor.select("#bombeui-controls-add-drum-button").on("click",()=>{this.addDrumColumn(this._defaultScramblerCasing,[0,1],null,0),this._overlayClicked(this._overlays[1],this._plugColumns[1])})}else if(column instanceof DrumColumn){this._drumUI.selectAll(function(){return this.childNodes}).each(function(){e.node().appendChild(this.cloneNode(!0))});{overlay=this._controlsAnchor.selectAll("[id^=bombeui-controls-scrambler-up]"),o=this._controlsAnchor.selectAll("[id^=bombeui-controls-scrambler-output]"),s=this._controlsAnchor.selectAll("[id^=bombeui-controls-scrambler-down]");let t=(i,dir)=>{let t=this._defaultScramblers.findIndex(x=>x.sameMapping(column.drum.scramblers.scramblers[i]));t=(t+dir+this._defaultScramblers.length)%this._defaultScramblers.length,column.drum.scramblers=new ScramblerCasing(column.drum.scramblers.scramblers.map((e,j)=>i===j?this._defaultScramblers[t].clone():e))};overlay.data([0,1,2]).on("click",(e,i)=>t(i,1)),s.data([0,1,2]).on("click",(e,i)=>t(i,-1)),o.data([0,1,2]).text(i=>BombeUI.ROMAN_NUMERALS[this._defaultScramblers.findIndex(x=>x.sameMapping(column.drum.scramblers.scramblers[i]))])}{overlay=this._controlsAnchor.selectAll("[id^=bombeui-controls-rotation-up]"),s=this._controlsAnchor.selectAll("[id^=bombeui-controls-rotation-output]"),o=this._controlsAnchor.selectAll("[id^=bombeui-controls-rotation-down]");let t=(i,dir)=>column.drum.rotations=column.drum.rotations.map((e,j)=>i===j?e+dir:e);overlay.data([0,1,2]).on("click",(e,i)=>t(i,1)),o.data([0,1,2]).on("click",(e,i)=>t(i,-1)),s.data([0,1,2]).text(i=>this.alphabet.toUpperCase().charAt(column.drum.rotations[i]))}overlay=this._controlsAnchor.selectAll("#bombeui-controls-reflector-up,#bombeui-controls-reflector-down"),o=this._controlsAnchor.select("#bombeui-controls-reflector-output");overlay.on("click",()=>{let t=this._defaultReflectors.findIndex(x=>x.sameMapping(column.drum.scramblers.scramblers[3]));t=(t+1)%this._defaultReflectors.length,column.drum.scramblers=new ScramblerCasing(column.drum.scramblers.scramblers.map((e,i)=>3===i?this._defaultReflectors[t].clone():e))}),o.text(this._defaultReflectors.findIndex(x=>x.sameMapping(column.drum.scramblers.scramblers[3]))?"C":"B");{const a=this._controlsAnchor.select("#bombeui-controls-drum-connected-to-output-left"),l=this._controlsAnchor.select("#bombeui-controls-drum-connected-to-output-right"),h=this._controlsAnchor.select("#bombeui-controls-drum-connected-to-left").on("input",()=>a.text(this.steckerAlphabet.charAt(parseInt(h.property("value"))))),c=this._controlsAnchor.select("#bombeui-controls-drum-connected-to-right").on("input",()=>l.text(this.steckerAlphabet.charAt(parseInt(c.property("value"))))),u=leftChanged=>{let t=parseInt(h.property("value")),e=parseInt(c.property("value"));t===e&&(leftChanged?h.property("value",++t!==this.alphabet.length?t:t-=2):c.property("value",++e!==this.alphabet.length?e:e-=2)),column.connectedTo=[t,e]};h.on("change",()=>u(!0)),c.on("change",()=>u(!1)),h.property("value",column.connectedTo[0]),c.property("value",column.connectedTo[1]),a.text(this.steckerAlphabet.charAt(column.connectedTo[0])),l.text(this.steckerAlphabet.charAt(column.connectedTo[1]))}this._controlsAnchor.select("#bombeui-controls-delete-drum-button").on("click",()=>this.deleteDrumColumn(this._plugColumns.indexOf(column)-1)),this._controlsAnchor.select("#bombeui-controls-add-drum-button").on("click",()=>{var t=this._plugColumns.indexOf(column);this.addDrumColumn(column.drum.scramblers,column.connectedTo,null,t),this._overlayClicked(this._overlays[t+1],this._plugColumns[t+1])})}}}deselectOverlay(){this._selectedOverlay&&this._overlayClicked(this._selectedOverlay,null)}destroy(){this._controlsAnchor.selectAll("*").remove();for(const t of this._overlays)t.remove();super.destroy()}}